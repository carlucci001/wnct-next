--- FILE: C:\dev\wnct-next\old_react_mds\AI-STUDIO-TROUBLESHOOTING.md ---
# AI Studio Troubleshooting Guide

## Problem: AI Studio Preview Pane Spinning/Sluggish

### Common Causes & Solutions

#### 1. **Large Files in Project**
AI Studio tries to analyze all files in your repository, which can cause performance issues.

**Solution:** I've created a `.aistudioignore` file that excludes:
- `node_modules/` (can be 200MB+)
- `dist/` build folder
- `.firebase/` cache
- Log files
- IDE files

**Action:** Make sure AI Studio respects the `.aistudioignore` file when loading the project.

---

#### 2. **AI Studio Configuration**

**Recommended Settings When Opening Project:**

1. **Repository URL:** `https://github.com/carlucci001/gwnct-core.git`
2. **Branch:** `dev` (not main!)
3. **Auto-deploy:** **OFF** (you control deployments manually)
4. **Preview Mode:** Try disabling live preview initially

---

#### 3. **Browser Performance Issues**

AI Studio runs in the browser and can be resource-intensive.

**Solutions:**
- Close other tabs/applications
- Try in an incognito/private window (clears cache)
- Clear browser cache: Ctrl+Shift+Delete
- Try a different browser (Chrome works best for AI Studio)
- Check if browser extensions are interfering (disable ad blockers)

---

#### 4. **Project-Specific Issues**

**Current Project Stats:**
- **Files:** ~40 source files
- **Build Size:** ~950KB
- **Dependencies:** React 19, Vite, Firebase, Tailwind

**If still spinning:**

1. **Clone fresh copy to test:**
   ```bash
   cd c:\dev
   git clone https://github.com/carlucci001/gwnct-core.git wnc-test
   cd wnc-test
   git checkout dev
   ```
   Then try opening `c:\dev\wnc-test` in AI Studio

2. **Verify Git status is clean:**
   ```bash
   git status
   # Should show "working tree clean"
   ```

3. **Check for uncommitted changes:**
   - AI Studio may struggle if there are many uncommitted files
   - All changes should be committed to `dev` branch

---

#### 5. **AI Studio Server Issues**

Sometimes the issue is on Google's side.

**Check:**
- Is AI Studio slow for other projects too?
- Try again in 10-15 minutes
- Check Google's status page

---

#### 6. **Workaround: Use Local Development Instead**

If AI Studio continues to be sluggish, you can work locally and manually sync:

```bash
# Work locally
cd c:\dev\wnc-times-clone
git checkout dev
npm run dev

# Make changes in your editor (VS Code, etc.)

# Commit and push
git add .
git commit -m "Your changes"
git push origin dev

# AI Studio will pick up changes on next load
```

---

## Recommended AI Studio Workflow

### **Initial Setup:**

1. Go to AI Studio
2. Click "New Project" or "Import from GitHub"
3. Enter repository: `https://github.com/carlucci001/gwnct-core.git`
4. Select branch: `dev`
5. **Disable auto-deploy**
6. Click "Load Project"

### **If Preview Pane Spins:**

1. **Don't panic** - production site is safe
2. Try refreshing the AI Studio page (F5)
3. Close and reopen the project
4. Try the incognito window approach
5. Check `.aistudioignore` is working

### **Once Loaded:**

1. Navigate to specific files instead of loading entire project at once
2. Use AI Studio's file search to find components
3. Make changes to individual files
4. Test changes locally before committing

---

## Project Files Most Likely to Edit

**Frontend Components:**
- `components/Header.tsx` - Header and navigation
- `components/BreakingNews.tsx` - Breaking news ticker
- `components/WeatherWidget.tsx` - Weather display
- `components/ChatAssistant.tsx` - AI chat interface

**Admin Dashboard:**
- `pages/AdminDashboard.tsx` - Main admin interface (large file, ~1400 lines)

**Services:**
- `services/db.ts` - IndexedDB operations
- `services/api.ts` - API calls
- `services/auth.ts` - Authentication

**Configuration:**
- `data/prompts.ts` - AI agent definitions
- `firebase.ts` - Firebase config
- `vite.config.ts` - Build config

---

## Current Project Status

âœ… **Production:** https://gen-lang-client-0242565142.web.app (deployed, live)
âœ… **Branch:** `dev` (20+ commits ahead of origin/dev)
âœ… **Local:** localhost:3000 (working)
âœ… **Git:** All changes committed and pushed

**Latest Features Deployed:**
- Collapsible admin sidebar
- Integrations page for API keys
- Articles filtering/sorting
- Sanitization persistence fix
- Breaking news alignment

---

## Emergency Recovery

**If AI Studio breaks something:**

```bash
# View recent commits
git log --oneline -10

# Restore to last good state
git checkout <commit-hash>

# Or restore to tagged version
git checkout v1.3-session-complete

# Reinstall dependencies
npm install

# Test locally
npm run dev
```

**Safe Restore Points:**
- `v1.3-session-complete` - Latest working version with all features
- `v1.1-weather-stable` - Weather widget + header layout
- `v1.0-stable` - Initial clean baseline

---

## Performance Optimization Tips

1. **Work on specific files** - Don't load entire codebase at once
2. **Commit frequently** - Smaller commits load faster
3. **Use .aistudioignore** - Exclude unnecessary files
4. **Close preview when not needed** - Saves resources
5. **Work in feature branches** - Keep dev branch clean

---

## Contact & Support

**Repository:** https://github.com/carlucci001/gwnct-core
**Issues:** Create GitHub issue if persistent problems
**Documentation:** See `DEPLOYMENT-GUIDE.md` and `SESSION-SUMMARY.md`

---

**Last Updated:** 2025-12-03
**Current Project:** WNC Times Clone (GWNCT Core)
**Firebase Project:** gen-lang-client-0242565142


--- FILE: C:\dev\wnct-next\old_react_mds\AI_HANDOFF.md ---
# AI Assistant Handoff Document

**Date**: 2025-12-05
**Project**: WNC Times Clone - News Publishing Platform
**Previous AI**: Claude Code (Anthropic)
**Target AI**: Gemini Code / Other AI Assistant

---

> Handoff annotation (2025-12-09): Codex assumed control here. See `HANDOFF_CHECKPOINT.md` for the exact pre-change checkpoint. Git is not available in this environment, so a commit/tag could not be created yet. If you enable git, create a baseline commit/tag first to preserve this state.

## ðŸŽ¯ Project Overview

This is a **full-stack news publishing platform** built as a clone of WNC Times (Western North Carolina Times). It's a React-based CMS with Firebase Firestore backend, user authentication, role-based access control, and AI-powered content generation.

### Tech Stack:
- **Frontend**: React 19 + TypeScript + Vite
- **Styling**: Tailwind CSS
- **Database**: Firebase Firestore (database: `gwnct`)
- **Local Cache**: IndexedDB (version 8)
- **Auth**: Custom password authentication + Google OAuth
- **AI Integration**: Google Gemini AI API for article generation
- **Icons**: Lucide React

### Key Features:
1. Complete user authentication system (password + OAuth)
2. Role-based access control (7 roles, 20 permissions)
3. Article management with news flow workflow
4. AI-powered article generation
5. Media library with image management
6. Categories, tags, and comments system
7. Admin dashboard with analytics

---

## ðŸ“ Critical Files and Architecture

### Core Application Files:
```
wnc-times-clone/
â”œâ”€â”€ App.tsx                          # Main app with routing, ProtectedRoute
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ AdminDashboard.tsx           # 4,700+ lines - Main admin interface
â”‚   â”œâ”€â”€ Login.tsx                    # Authentication UI
â”‚   â”œâ”€â”€ Home.tsx                     # Public homepage
â”‚   â””â”€â”€ ArticleDetail.tsx            # Article reader view
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth.ts                      # Authentication service (localStorage)
â”‚   â”œâ”€â”€ db.ts                        # IndexedDB service (version 8)
â”‚   â”œâ”€â”€ googleAuth.ts                # Google OAuth integration
â”‚   â”œâ”€â”€ passwordUtils.ts             # SHA-256 password hashing
â”‚   â””â”€â”€ imageGeneration.ts           # AI image generation
â”œâ”€â”€ firebase.ts                      # Firebase config (Firestore 'gwnct')
â”œâ”€â”€ types.ts                         # TypeScript interfaces
â””â”€â”€ data/
    â”œâ”€â”€ rolePermissions.ts           # RBAC permission matrix
    â””â”€â”€ prompts.ts                   # AI agent prompts
```

### Key Data Flow:
```
Firebase Firestore ('gwnct')
    â””â”€â”€ collection('articles') â”€â”€â”
                                 â”œâ”€â†’ AdminDashboard.loadData()
    localStorage (authService)   â”‚       â”‚
    â””â”€â”€ users (admin/admin123) â”€â”˜       â”œâ”€â†’ React State
                                         â”‚   â”œâ”€â”€ articles
                                         â”‚   â”œâ”€â”€ appUsers
IndexedDB (version 8)            â†â”€â”€â”€â”€â”€â”€â”€â”˜   â”œâ”€â”€ categories
â””â”€â”€ Cache layer for offline              â””â”€â”€ comments
```

---

## ðŸ”‘ Authentication & Users

### Admin Credentials:
- **Username**: `admin`
- **Password**: `admin123`

### User Storage:
- **Primary**: `localStorage` via `authService`
- **Cache**: IndexedDB `users` store
- **Initialization**: `authService.initializeStorage()` creates admin user if missing

### 7 User Roles (Hierarchy):
1. **admin** - Full system access
2. **business-owner** - Business management, no infrastructure
3. **editor-in-chief** - Editorial workflow, can publish
4. **editor** - Review/edit, cannot publish
5. **content-contributor** - Create drafts only
6. **commenter** - Comment on articles
7. **reader** - Read-only access
8. **guest** - Blocked user (used for blocking)

### 20 Permissions (see data/rolePermissions.ts):
- Content: create, edit (own/any), delete (own/any), publish, view drafts, manage comments
- Users: create, edit, delete, assign roles, view activity
- System: site settings, API config, theme, categories, tags, media, infrastructure

---

## ðŸ”¥ Critical Firebase Integration (RECENT FIX)

### Problem That Was Solved:
- Articles were stored in **Firebase Firestore** but app was only querying **IndexedDB**
- IndexedDB was empty after version upgrade (7â†’8)
- User thought all articles were lost

### Current Solution (Commit f7245fa):
```typescript
// pages/AdminDashboard.tsx lines 337-359
const loadData = async () => {
  // Load articles from Firebase Firestore (PRIMARY SOURCE)
  const articlesSnapshot = await getDocs(collection(firestore, 'articles'));
  let arts = articlesSnapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  })) as Article[];

  // Cache to IndexedDB for offline access
  if (arts.length > 0) {
    await dbService.saveArticles(arts);
  }
}
```

**Important**: Firebase Firestore is the **source of truth** for articles. IndexedDB is just a cache.

---

## ðŸš¨ Known Issues & Technical Debt

### 1. IndexedDB Version History (CRITICAL):
- **Never change `DB_VERSION` from 8** without migration strategy
- Previous version bump (7â†’8) caused data loss because:
  - IndexedDB creates new empty database on version upgrade
  - Old data in version 7 became inaccessible
  - Browser won't downgrade versions
- If version needs to change, must implement data migration

### 2. Three-Layer Storage Confusion:
- Firebase Firestore (articles, eventually all data)
- localStorage (users, current session)
- IndexedDB (cache for offline access)
- **Risk**: Inconsistencies between layers

### 3. AdminDashboard.tsx Size:
- **4,700+ lines** in a single component
- Should be refactored into smaller components
- Current structure:
  - 50+ render functions
  - 100+ state variables
  - Multiple concerns (articles, users, media, settings)

### 4. No Backend API:
- All data operations are client-side
- No server-side validation
- Security concerns with client-side role checks

### 5. Password Security:
- Uses SHA-256 with salt (better than nothing)
- Should use bcrypt/argon2 with proper backend
- Passwords stored in localStorage (not ideal)

---

## ðŸ“ Recent Changes (Last 7 Commits)

```
d931db8 - Add user deletion functionality to Users section
a619c11 - Update SESSION_ANALYSIS.md - document Firebase Firestore fix
f7245fa - Fix data loading to use Firebase Firestore instead of IndexedDB
d7a06dc - Update SESSION_ANALYSIS.md - mark all tasks complete
e61bf37 - Add News Flow Status Bar and fix Admin Dashboard layout
9dec0a8 - Restore Users menu items and AI Article Generator features
c3d7ada - Fix Login page with complete authentication UI
```

### What Works Now:
âœ… Articles load from Firebase Firestore
âœ… Admin user (admin/admin123) auto-initializes
âœ… Complete user management (create, edit, delete, block)
âœ… News Flow Status Bar in article editor
âœ… Admin Dashboard layout (max-width 1800px)
âœ… Roles & Permissions matrix display
âœ… AI Article Generator with publish workflow

---

## ðŸ—ï¸ Architecture Decisions

### Why Firebase Firestore?
- User already had Firebase project set up
- Articles collection with existing data
- No backend infrastructure needed

### Why localStorage for Auth?
- Simple client-side solution
- No backend auth server
- Session management with 30-minute timeout

### Why IndexedDB?
- Offline access capability
- Large data storage (compared to localStorage)
- Structured data with object stores

### Why React 19 + Vite?
- Fast development with HMR
- Modern React features
- TypeScript support

---

## ðŸš€ How to Run

```bash
# Install dependencies
npm install

# Start dev server
npm run dev
# Opens at http://localhost:3001 (or 3000 if available)

# Login credentials
Username: admin
Password: admin123

# Firebase config is in firebase.ts
# Database name: 'gwnct'
# Collection: 'articles'
```

---

## ðŸ” What to Review

### If You're Gemini (or Another AI):

1. **Architecture Review**:
   - Is the 4,700-line AdminDashboard.tsx acceptable or should it be refactored?
   - Should we migrate fully to Firebase Firestore (remove IndexedDB/localStorage)?
   - Is the three-layer storage strategy sustainable?

2. **Security Concerns**:
   - Client-side auth with localStorage - is this acceptable for production?
   - SHA-256 password hashing - should we upgrade to bcrypt/argon2?
   - Role-based access control implemented client-side only

3. **Code Quality**:
   - TypeScript usage - are there `any` types that should be stricter?
   - Error handling - are try/catch blocks comprehensive enough?
   - State management - should we use Redux/Zustand instead of 100+ useState?

4. **Performance**:
   - Loading all articles at once - should we implement pagination?
   - Re-rendering optimization - are memoization opportunities missed?
   - Firebase queries - are they optimized?

5. **User Experience**:
   - News Flow Status Bar - is the workflow intuitive?
   - Admin Dashboard - is navigation clear with current menu structure?
   - Error messages - are they user-friendly?

---

## ðŸ“Š Codebase Statistics

- **Total Lines**: ~8,000+ (estimated)
- **Largest File**: AdminDashboard.tsx (4,700 lines)
- **TypeScript Files**: 25+
- **React Components**: 15+
- **Database Version**: IndexedDB v8 (don't change!)
- **Firebase Collections**: 1 active (articles), more planned

---

## ðŸŽ¯ Potential Improvements

1. **Refactor AdminDashboard.tsx**:
   - Extract render functions into separate components
   - Use component composition
   - Implement lazy loading for tabs

2. **Backend API**:
   - Create Express/Fastify backend
   - Move auth to server-side (JWT tokens)
   - Server-side validation and role checks

3. **State Management**:
   - Replace 100+ useState with Redux Toolkit or Zustand
   - Centralize data fetching
   - Implement optimistic updates

4. **Testing**:
   - Add unit tests (Jest + React Testing Library)
   - E2E tests (Playwright/Cypress)
   - Integration tests for Firebase

5. **Performance**:
   - Implement pagination for articles
   - Virtual scrolling for long lists
   - Code splitting and lazy loading

6. **DevOps**:
   - Set up CI/CD pipeline
   - Environment variables for Firebase config
   - Production build optimization

---

## ðŸ¤ Handoff Protocol

### To Successfully Continue This Project:

1. **Read This Document** - Understand architecture and decisions
2. **Read SESSION_ANALYSIS.md** - Recent changes and fixes
3. **Review data/rolePermissions.ts** - Understand RBAC
4. **Check firebase.ts** - Verify Firebase connection
5. **Run `npm run dev`** - Test that everything works
6. **Login as admin** - Verify auth flow
7. **Check Users section** - Test CRUD operations
8. **Review AdminDashboard.tsx** - Understand main component

### Questions to Ask the User:

- What's the primary goal: production deployment or continued development?
- Are there specific pain points with current architecture?
- Is refactoring the 4,700-line component a priority?
- Should we migrate to a proper backend or keep client-side?
- What's the target user base size? (impacts scaling decisions)

---

## ðŸ“ž Contact & Resources

**Project Path**: `c:\dev\wnc-times-clone`
**Git Branch**: `dev`
**Firebase Project**: `gen-lang-client-0242565142`
**Database**: Firestore `gwnct`

**Key Documentation**:
- `SESSION_ANALYSIS.md` - Recent session history
- `ROLES_PERMISSIONS_STRUCTURE.md` - RBAC design
- `data/rolePermissions.ts` - Permission implementation

**Dev Server**: http://localhost:3001
**Admin Login**: admin / admin123

---

*This handoff document was created to facilitate transition between AI assistants. Good luck with the review!*


--- FILE: C:\dev\wnct-next\old_react_mds\AI_INSTRUCTIONS.md ---
# AI Instructions for WNC Times Project

**READ THIS FIRST BEFORE MAKING ANY CHANGES**

## Core Principle
**DO NOT modify files unless explicitly requested by the user. When in doubt, ask first.**

---

## ðŸš« PROTECTED FILES - DO NOT MODIFY WITHOUT EXPLICIT APPROVAL

### Critical Configuration Files
- `firebase.ts` - Firebase database connection (connects to named 'gwnct' database)
- `vite.config.ts` - Build configuration
- `package.json` / `package-lock.json` - Dependencies
- `.firebaserc` - Firebase project configuration
- `firebase.json` - Firebase hosting configuration
- `index.html` - HTML entry point with importmap and Tailwind config

### Core Services (Modify only if explicitly requested)
- `services/api.ts` - Firestore data fetching logic
- `services/db.ts` - IndexedDB caching layer
- `types.ts` - TypeScript type definitions

### Layout & Styling Components (NO CHANGES unless explicitly requested)
- `components/Header.tsx` - Navigation header
- `components/Footer.tsx` - Site footer
- `components/HeroSection.tsx` - Homepage hero section
- `components/ArticleCard.tsx` - Article preview cards
- `components/Sidebar.tsx` - Trending/categories sidebar
- `components/Breadcrumbs.tsx` - Navigation breadcrumbs
- `components/DirectoryCard.tsx` - Business directory cards
- `components/CategoryFeaturedSlider.tsx` - Category slider
- `components/BreakingNews.tsx` - Breaking news banner

### Page Components (Layouts are pixel-perfect - preserve exactly)
- `pages/Home.tsx` - Homepage layout
- `pages/Articles.tsx` - Article listing page
- `pages/ArticleDetail.tsx` - Single article view
- `pages/About.tsx` - About page
- `pages/Contact.tsx` - Contact page
- `pages/AdminDashboard.tsx` - Admin CMS interface

---

## âš ï¸ STRICT RULES

### 1. Layout & Styling
- **NO changes to component layouts, spacing, sizing, or positioning**
- **NO modifications to Tailwind classes unless explicitly requested**
- **NO refactoring component structure or JSX hierarchy**
- **NO adding new UI elements or changing existing ones**
- Layouts are considered pixel-perfect and production-ready

### 2. Firebase & Database
- **NEVER modify firebase.ts without explicit user approval**
- Database connection MUST use: `getFirestore(app, 'gwnct')`
- Named database is `gwnct` - NOT the default database
- **DO NOT change Firestore queries or collection names**

### 3. File Organization
- **NO moving files to different directories**
- **NO creating new directory structures**
- **NO renaming files or folders**
- Keep the existing flat structure (components/, pages/, services/ at root)

### 4. Dependencies
- **NO adding new npm packages without user approval**
- **NO updating existing package versions**
- **NO removing packages**

### 5. Build Configuration
- **NO changes to vite.config.ts**
- **NO modifications to index.html structure**
- **DO NOT remove or modify the importmap**

### 6. Scope Discipline
- **ONLY work on the specific task requested**
- **NO "improvements" or "optimizations" unless asked**
- **NO adding features "while you're at it"**
- **NO refactoring surrounding code**
- **NO adding comments or documentation unless requested**

---

## âœ… ALLOWED ACTIONS

### You MAY do these without asking:
1. Fix actual bugs that break functionality
2. Add error handling to prevent crashes
3. Update logic inside functions (not structure) for requested features
4. Add new utility functions in appropriate service files
5. Create new components ONLY if explicitly requested for a new feature

### You MUST ask permission for:
1. Any layout or styling changes
2. Component restructuring
3. File moves or renames
4. Firebase configuration changes
5. Adding new dependencies
6. Modifying build configuration
7. Changing routing structure
8. Adding new pages

---

## ðŸ”§ WHEN MAKING CHANGES

### Before Starting
1. Read the user's request carefully
2. Identify EXACTLY what needs to change
3. Determine if any protected files are affected
4. If protected files need changes, **ASK FOR EXPLICIT APPROVAL FIRST**

### During Development
1. Make the MINIMUM changes necessary
2. Do NOT modify files adjacent to your work
3. Do NOT "clean up" code you didn't write
4. Preserve all existing formatting and style
5. Test that your changes don't break existing functionality

### Before Committing
1. Verify ONLY requested changes were made
2. No accidental modifications to protected files
3. No new files created unless explicitly needed
4. Build succeeds without errors

---

## ðŸ“ COMMIT GUIDELINES

### Commit Messages
- Be specific about what changed and why
- Reference the user's request
- Example: "Add article search functionality per user request"
- NOT: "Improve codebase" or "Refactor components"

### Before Committing
Always verify the current state is working:
```bash
npm run build  # Must succeed
firebase deploy --only hosting  # If deploying
```

---

## ðŸš¨ CRITICAL REMINDERS

### Firebase Database Connection
```typescript
// âœ… CORRECT - Named database
export const db = getFirestore(app, 'gwnct');

// âŒ WRONG - Default database (will find 0 articles)
export const db = getFirestore(app);
```

### IndexedDB Version
- Current version: 5
- Only increment if schema changes
- Graceful fallback to Firestore if IndexedDB fails

### Mock Data
- Used ONLY as fallback when Firestore is unavailable
- Should load real data from Firestore in production
- Mock data exists in `services/api.ts`

---

## ðŸ“Š PROJECT STATUS

### Current Stable Version
- **Commit:** `5e905d7`
- **Tag:** `v1.0-stable`
- **Status:** Production-ready, loading real Firestore data

### Restore Point
If anything breaks:
```bash
git reset --hard v1.0-stable
npm run build
firebase deploy --only hosting
```

---

## ðŸŽ¯ TASK EXECUTION CHECKLIST

Before making ANY changes, verify:

- [ ] User explicitly requested this change
- [ ] I understand EXACTLY what needs to change
- [ ] No protected files will be modified without approval
- [ ] I'm not making unsolicited improvements
- [ ] I'm not touching layouts/styling unless requested
- [ ] I'm not reorganizing files or folders
- [ ] I have approval if adding dependencies
- [ ] Changes are minimal and focused

After making changes, verify:

- [ ] ONLY requested files were modified
- [ ] Build succeeds: `npm run build`
- [ ] No layout/styling was accidentally changed
- [ ] No files were moved or renamed
- [ ] Commit message is specific and clear
- [ ] Ready to create restore point if this is significant

---

## ðŸ’¬ COMMUNICATION PROTOCOL

### When Uncertain
**ALWAYS ask the user before:**
- Modifying protected files
- Changing layouts or styling
- Adding new dependencies
- Restructuring code
- Adding features not explicitly requested

### Response Format
When proposing changes:
1. List exactly what files will be modified
2. Describe what will change in each file
3. Explain why it's necessary
4. Wait for explicit approval before proceeding

---

## ðŸ SUCCESS CRITERIA

A change is successful when:
1. âœ… User's specific request is fulfilled
2. âœ… Build completes without errors
3. âœ… Site loads real data from Firestore
4. âœ… No protected files were modified without approval
5. âœ… No layouts or styling were changed
6. âœ… No files were reorganized
7. âœ… Clean commit with specific message
8. âœ… Documentation updated if needed

---

**Remember: The goal is surgical precision, not comprehensive improvement. Do what's asked, nothing more.**


--- FILE: C:\dev\wnct-next\old_react_mds\AUTHENTICATION_GUIDE.md ---
# Authentication & Authorization System Guide

## Overview

The WNC Times application now features a comprehensive authentication and authorization system with the following capabilities:

- **Password-based authentication** with secure hashing (SHA-256)
- **Google OAuth integration** via Firebase
- **Role-based access control (RBAC)** with 7 user roles
- **Permission-based authorization** with 17 granular permissions
- **Session management** with automatic timeout (30 minutes)
- **Remember Me** functionality (30 days)
- **Password reset flow** with secure tokens
- **Route protection** based on roles and permissions

## User Roles

The system supports 7 hierarchical roles:

1. **Admin** - Full system access
2. **Business Owner** - Business-level access, cannot access infrastructure
3. **Editor-in-Chief** - Manages editorial workflow and publishing
4. **Editor** - Reviews and edits content, limited publishing rights
5. **Content Contributor** - Creates articles, limited to own content
6. **Commenter** - Can post and manage own comments (default for new users)
7. **Reader** - Read-only access
8. **Guest** - No authenticated access

See [ROLES_PERMISSIONS_STRUCTURE.md](ROLES_PERMISSIONS_STRUCTURE.md) for detailed permissions matrix.

## Key Features

### 1. User Registration

New users can register with:
- Full name
- Username (for login)
- Email address
- Password (with strength validation)

**Default Role**: Commenter (automatic approval)

**Password Requirements**:
- Minimum 8 characters
- At least one uppercase letter
- At least one lowercase letter
- At least one number
- At least one special character

### 2. Login Options

Users can log in using:
- **Username** or **Email** + Password
- **Google Sign-In** (if Firebase is configured)

**Remember Me**: Optional 30-day session persistence

### 3. Session Management

- **Session Timeout**: 30 minutes of inactivity
- **Warning**: 5 minutes before expiration
- **Auto-refresh**: On any user interaction
- **Cleanup**: Expired sessions automatically removed

### 4. Password Reset

Users can reset forgotten passwords through a secure flow:

1. Request reset at `/forgot-password`
2. Receive reset token (simulated email)
3. Use token at `/reset-password?token=XXX`
4. Set new password
5. Token expires after 1 hour

### 5. Route Protection

Routes can be protected with three levels:

```typescript
// Require authentication only
<ProtectedRoute>
  <Component />
</ProtectedRoute>

// Require specific role(s)
<ProtectedRoute requireRole={['admin', 'business-owner']}>
  <Component />
</ProtectedRoute>

// Require specific permission
<ProtectedRoute requirePermission="canPublishArticle">
  <Component />
</ProtectedRoute>
```

## File Structure

### Core Services

- **[services/auth.ts](services/auth.ts)** - Authentication logic, user management
- **[services/passwordUtils.ts](services/passwordUtils.ts)** - Password hashing, validation, token generation
- **[services/googleAuth.ts](services/googleAuth.ts)** - Google OAuth integration
- **[data/rolePermissions.ts](data/rolePermissions.ts)** - Role definitions and permission helpers

### Components

- **[components/ProtectedRoute.tsx](components/ProtectedRoute.tsx)** - Route protection wrapper
- **[components/SessionManager.tsx](components/SessionManager.tsx)** - Session timeout warnings

### Pages

- **[pages/Login.tsx](pages/Login.tsx)** - Login & registration UI
- **[pages/ForgotPassword.tsx](pages/ForgotPassword.tsx)** - Password reset request
- **[pages/ResetPassword.tsx](pages/ResetPassword.tsx)** - Password reset form
- **[pages/AccessDenied.tsx](pages/AccessDenied.tsx)** - Permission denied page

### Type Definitions

- **[types.ts](types.ts:132-156)** - User interface with auth fields

## Setup Instructions

### 1. Environment Variables

Copy `.env.example` to `.env` and configure:

```bash
# Required for password authentication (already working)
# No additional setup needed

# Optional: For Google Sign-In
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_domain.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_bucket.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
```

### 2. Firebase Setup (Optional - for Google OAuth)

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Create a new project or select existing
3. Enable **Authentication** â†’ **Sign-in method** â†’ **Google**
4. Copy configuration values to `.env`
5. Add authorized domains (localhost, your production domain)

### 3. Default Admin Account

On first run, an admin account is automatically created:

- **Username**: `admin`
- **Email**: `admin@wnctimes.com`
- **Password**: `admin123`
- **Role**: Admin

**Important**: Change this password after first login!

## Usage Examples

### Check User Permissions

```typescript
import { authService } from './services/auth';
import { hasPermission } from './data/rolePermissions';

const user = authService.getCurrentUser();

// Check if user can publish articles
if (hasPermission(user, 'canPublishArticle')) {
  // Show publish button
}

// Check user role
if (user?.role === 'admin') {
  // Admin-only feature
}
```

### Protect a Component

```typescript
import ProtectedRoute from './components/ProtectedRoute';

// In your routes
<Route
  path="/admin"
  element={
    <ProtectedRoute requireRole={['admin', 'business-owner']}>
      <AdminDashboard />
    </ProtectedRoute>
  }
/>
```

### Manually Refresh Session

```typescript
import { authService } from './services/auth';

// Extend user session
authService.refreshActivity();

// Check if session is still valid
if (authService.isSessionValid()) {
  // Session is active
} else {
  // Session expired, redirect to login
}
```

### Create New User (Admin Only)

```typescript
import { authService } from './services/auth';

// Register with password
const user = await authService.registerWithPassword(
  'John Doe',
  'john@example.com',
  'johndoe',
  'SecurePass123!'
);

// Admin creates user
const adminUser = authService.adminCreateUser(
  'Jane Editor',
  'jane@wnctimes.com',
  'editor'
);
```

## Security Considerations

### Current Implementation (Client-Side)

- **Storage**: localStorage (XSS vulnerable)
- **Hashing**: SHA-256 with salt (client-side)
- **Tokens**: Cryptographically secure random tokens
- **Session**: 30-minute timeout with activity tracking

### Known Limitations

1. **Client-side validation only** - All security checks happen in browser
2. **localStorage XSS risk** - Tokens stored in localStorage are vulnerable
3. **No rate limiting** - Password attempts are not limited
4. **Simulated email** - Password reset tokens logged to console

### Migration to Backend (Recommended)

For production, consider:

1. **Backend Authentication**
   - Use JWT tokens with HTTP-only cookies
   - Server-side password hashing (bcrypt, Argon2)
   - Rate limiting on auth endpoints
   - CSRF protection

2. **Database Storage**
   - Store users in Firebase Firestore or PostgreSQL
   - Hash passwords server-side before storage
   - Audit logging for security events

3. **Email Service**
   - Integrate SendGrid, AWS SES, or similar
   - Send real password reset emails
   - Email verification on registration

4. **Security Headers**
   - Content Security Policy (CSP)
   - X-Frame-Options
   - Strict-Transport-Security

## API Reference

### authService

```typescript
// Initialize storage (call on app start)
await authService.initializeStorage()

// Registration
const user = await authService.registerWithPassword(
  name: string,
  email: string,
  username: string,
  password: string
): Promise<User>

// Login
const user = await authService.loginWithPassword(
  identifier: string,  // username or email
  password: string,
  rememberMe: boolean
): Promise<User>

// Google OAuth
const user = await authService.loginWithGoogle(
  googleUser: { email: string; name: string; picture?: string }
): Promise<User>

// Password Reset
await authService.requestPasswordReset(email: string): Promise<string>
const user = authService.verifyResetToken(token: string): User | null
await authService.resetPassword(token: string, newPassword: string): Promise<void>

// Password Update
await authService.updatePassword(
  userId: string,
  currentPassword: string,
  newPassword: string
): Promise<void>

// Session Management
const isValid = authService.isSessionValid(): boolean
authService.refreshActivity(): void
const time = authService.getTimeUntilExpiry(): number
authService.checkAndCleanupSessions(): void

// User Management
const user = authService.getCurrentUser(): User | null
const users = authService.getUsers(): User[]
authService.updateUser(user: User): void
authService.logout(): void
```

### Permission Helpers

```typescript
import { hasPermission, getUserPermissions, ROLE_PERMISSIONS } from './data/rolePermissions';

// Get effective permissions for user
const permissions = getUserPermissions(user)

// Check specific permission
const canPublish = hasPermission(user, 'canPublishArticle')

// Get role defaults
const adminPerms = ROLE_PERMISSIONS['admin']
```

## Testing Checklist

- [ ] Register new user with valid password
- [ ] Login with username
- [ ] Login with email
- [ ] Login with Google (if configured)
- [ ] Remember Me checkbox persists session
- [ ] Session timeout warning appears at 5 minutes
- [ ] Session expires after 30 minutes of inactivity
- [ ] User activity refreshes session
- [ ] Forgot password sends reset link
- [ ] Reset password with valid token
- [ ] Reset password with expired token fails
- [ ] Access denied page shows for insufficient permissions
- [ ] Admin dashboard requires admin/business-owner/editor-in-chief role
- [ ] Protected routes redirect to login when not authenticated
- [ ] Password strength indicator works
- [ ] Password validation prevents weak passwords

## Troubleshooting

### Google Sign-In Not Working

1. Check Firebase configuration in `.env`
2. Verify Google Sign-in is enabled in Firebase Console
3. Add your domain to Firebase authorized domains
4. Check browser console for errors

### Session Keeps Expiring

1. Check if `lastActivity` is being updated
2. Verify SESSION_TIMEOUT constant in [services/auth.ts:16](services/auth.ts#L16)
3. Check browser console for session cleanup logs

### Password Reset Link Invalid

1. Tokens expire after 1 hour
2. Check token in URL matches token in user storage
3. Verify reset link format: `/reset-password?token=XXX`

### Access Denied Loop

1. Check user role matches required role in ProtectedRoute
2. Verify permission checks in [data/rolePermissions.ts](data/rolePermissions.ts)
3. Check if user is suspended (`status === 'suspended'`)

## Future Enhancements

- [ ] Two-factor authentication (2FA)
- [ ] OAuth providers (GitHub, Twitter, etc.)
- [ ] Email verification on registration
- [ ] Account lockout after failed attempts
- [ ] Password history (prevent reuse)
- [ ] Security questions
- [ ] Activity log viewer
- [ ] Admin user management UI
- [ ] Bulk role assignments
- [ ] Custom permission overrides per user

## Support

For questions or issues:
- Review [ROLES_PERMISSIONS_STRUCTURE.md](ROLES_PERMISSIONS_STRUCTURE.md)
- Check browser console for error messages
- Verify environment variables are set correctly
- Contact development team


--- FILE: C:\dev\wnct-next\old_react_mds\CLAUDE.md ---
# Claude Code Instructions

**Project**: WNC Times Clone - News Publishing Platform
**Stack**: React 19 + TypeScript + Vite + Firebase Firestore + Tailwind CSS

## Quick Reference

- **Dev server**: `npm run dev` (localhost:3001)
- **Build**: `npm run build`
- **Admin login**: admin / admin123
- **Firebase database**: `gwnct` (named database, not default)
- **Stable restore**: `git reset --hard v1.1-stable`

## Core Principle

**DO NOT modify files unless explicitly requested. When in doubt, ask first.**

## Protected Files - DO NOT MODIFY

### Critical Config
- `firebase.ts` - Database connection (uses named 'gwnct' database)
- `vite.config.ts` - Build configuration
- `package.json` / `package-lock.json` - Dependencies
- `index.html` - Entry point with importmap

### Core Services
- `services/db.ts` - IndexedDB cache (version 8 - NEVER change version)
- `services/api.ts` - Firestore data fetching
- `types.ts` - TypeScript definitions

### Layout Components (pixel-perfect - preserve exactly)
- `components/Header.tsx`
- `components/Footer.tsx`
- `components/HeroSection.tsx`
- `components/ArticleCard.tsx`
- `components/Sidebar.tsx`
- `components/BreakingNews.tsx`
- `components/CategoryFeaturedSlider.tsx`

## Strict Rules

1. **No layout/styling changes** unless explicitly requested
2. **No new dependencies** without approval
3. **No file moves or renames**
4. **No refactoring** surrounding code
5. **No unsolicited improvements**
6. **Minimum changes only** - surgical precision

## Allowed Without Asking

- Fix bugs that break functionality
- Add error handling to prevent crashes
- Update logic inside functions for requested features
- Create new components ONLY if explicitly requested

## Must Ask Permission For

- Layout or styling changes
- Firebase configuration changes
- Adding dependencies
- Component restructuring
- New pages or routing changes

## Before Committing

```bash
npm run build  # Must succeed
```

Commit messages: Be specific, reference user's request, no generic "improvements"

## Critical Technical Notes

### Firebase Connection
```typescript
// CORRECT - Named database
export const db = getFirestore(app, 'gwnct');

// WRONG - Will find 0 articles
export const db = getFirestore(app);
```

### IndexedDB
- Current version: 8
- NEVER increment without migration strategy
- Version bump = data loss without migration

## Documentation

- `AI_INSTRUCTIONS.md` - Full guardrails (detailed version)
- `AI_HANDOFF.md` - Architecture and technical decisions
- `data/prompts.ts` - AI agent configurations
- `data/rolePermissions.ts` - RBAC permission matrix

## Success Criteria

1. User's specific request fulfilled
2. Build passes
3. No protected files modified without approval
4. No layout/styling changes
5. Clean commit with specific message


--- FILE: C:\dev\wnct-next\old_react_mds\COPILOT-ERROR-FIX.md ---
# Fix: GitHub Copilot "image media type is required" Error

## Error Message
```
Sorry, your request failed. Please try again.
Reason: Request Failed: 400 {"error":{"message":"image media type is required","code":"invalid_request_body"}}
```

## What Happened
GitHub Copilot tried to process an image file and failed because it doesn't properly support images yet.

## Quick Fix (Choose One)

### Solution 1: Close Image Files
1. In VS Code, close all tabs showing images (.png, .jpg, .svg, etc.)
2. Make sure you have a **code file** open (.tsx, .ts, .js)
3. Click the Copilot chat icon again
4. Try your request

### Solution 2: Clear Copilot Cache
1. Press `Ctrl+Shift+P` (Command Palette)
2. Type: `Copilot: Reset`
3. Select "GitHub Copilot: Reset Chat"
4. Try your request again

### Solution 3: Restart VS Code
1. Close VS Code completely (File â†’ Exit)
2. Reopen VS Code
3. Open your project: `c:\dev\wnc-times-clone`
4. Open a code file (like `components/Header.tsx`)
5. Try Copilot chat again

### Solution 4: Disable Image Context
1. Press `Ctrl+,` (Settings)
2. Search: "copilot image"
3. Uncheck "Include images in context"
4. Restart VS Code

## How to Prevent This Error

**Don't do this:**
- Ask Copilot about images
- Have image files selected when using chat
- Use screenshots in Copilot chat

**Do this instead:**
- Keep code files (.ts, .tsx, .js) active
- If you need to discuss images, describe them in text
- Close Preview panes before using Copilot

## If Error Persists

### Check Copilot Status
1. Look at bottom-right of VS Code
2. Should say "Copilot: Ready"
3. If it says "Copilot: Error", click it to see details

### Reinstall Copilot Extension
1. Go to Extensions (Ctrl+Shift+X)
2. Search: "GitHub Copilot"
3. Click "Uninstall"
4. Click "Install"
5. Reload VS Code

### Check Your Subscription
1. Go to: https://github.com/settings/copilot
2. Make sure your subscription is active
3. Check if "Copilot Chat" is enabled

## Alternative: Use Continue.dev Extension

If Copilot keeps failing, try Continue.dev (free, uses Gemini):

1. **Install Continue Extension**
   - Extensions â†’ Search "Continue"
   - Install "Continue - Codegen, Chat, and more"

2. **Configure with Gemini**
   - Open Continue sidebar (Ctrl+L)
   - Click gear icon â†’ Settings
   - Add provider: "Google Gemini"
   - Paste your Gemini API key from `.env`

3. **Use Continue Instead**
   - Press Ctrl+L to open chat
   - Ask your coding questions
   - No more image errors!

## Understanding the Error

### Why This Happens
GitHub Copilot recently added experimental image support, but it's buggy. The error occurs when:
- VS Code thinks you want to attach an image
- Copilot doesn't know how to handle it
- The request fails with a 400 error

### Why It's Confusing
- You probably didn't even TRY to send an image
- VS Code might auto-select images in your workspace
- Copilot's image detection is overly sensitive

### Microsoft's Response
This is a known bug. Microsoft is working on a fix, but it's not available yet.

## Workaround Workflow

**When using Copilot Chat:**

1. âœ… Open a CODE file first (e.g., `Header.tsx`)
2. âœ… Make sure cursor is in the code editor
3. âœ… Click Copilot chat icon
4. âœ… Type your question
5. âŒ Don't have image files open in other tabs
6. âŒ Don't paste screenshots
7. âŒ Don't select image files in file explorer

## Test If It's Fixed

Try this in Copilot chat:
```
"Add a console.log statement to the Header component"
```

**If it works:** Error is fixed!
**If it fails:** Try Solution 3 (Restart VS Code)

## Still Not Working?

If none of these solutions work:

### Option A: Use Terminal AI
Instead of Copilot chat, use inline suggestions:
1. Just start typing code
2. Copilot will suggest completions
3. Press Tab to accept

### Option B: Switch to Cursor
1. Download: https://cursor.sh
2. Install (it's like VS Code but better)
3. Configure with Gemini API key
4. Never see this error again

### Option C: Use Gemini API Directly
Create a file: `ask-gemini.js`
```javascript
const { GoogleGenerativeAI } = require("@google/generative-ai");
const genAI = new GoogleGenerativeAI(process.env.VITE_GEMINI_API_KEY);

async function ask(question) {
  const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-exp" });
  const result = await model.generateContent(question);
  console.log(result.response.text());
}

ask("How do I add a button to my React component?");
```

Run: `node ask-gemini.js`

## Summary

**The error means:** Copilot is confused about images
**Quick fix:** Close image files, restart VS Code
**Long-term fix:** Switch to Cursor or Continue.dev
**Cost:** Free (Continue.dev) or $20/month (Cursor)

## Need More Help?

- **GitHub Copilot Support:** https://support.github.com/contact
- **Cursor Discord:** https://discord.gg/cursor
- **Continue.dev Docs:** https://continue.dev/docs

---

**Bottom Line:** This is a GitHub Copilot bug, not your fault. The fixes above should resolve it. If not, consider switching to Cursor (much more reliable).


--- FILE: C:\dev\wnct-next\old_react_mds\DEPLOYMENT-GUIDE.md ---
# Deployment & Environment Setup Guide

This guide ensures your production environment stays safe while AI Studio (or any developer) works on the `dev` branch.

---

## ðŸ›¡ï¸ Part 1: GitHub Branch Protection (Recommended)

Protect your `main` branch from accidental direct commits or force pushes.

### Setup Steps:

1. **Go to GitHub Repository**
   - Navigate to: https://github.com/carlucci001/gwnct-core
   - Click **Settings** tab (top right)
   - Click **Branches** (left sidebar under "Code and automation")

2. **Add Branch Protection Rule**
   - Click **"Add branch protection rule"**
   - Branch name pattern: `main`

3. **Enable These Protection Rules:**

   #### âœ… Required Settings:
   - [x] **Require a pull request before merging**
     - This forces all changes to go through pull requests
     - Prevents direct commits to `main`

   - [x] **Require approvals** (optional but recommended)
     - Require 1 approval before merging
     - You can approve your own PRs if you're the only developer

   - [x] **Dismiss stale pull request approvals when new commits are pushed**
     - Ensures reviews stay current

   - [x] **Require review from Code Owners** (optional)
     - Only if you have multiple team members

   #### âœ… Additional Protections:
   - [x] **Require status checks to pass before merging** (optional)
     - Add build/test checks if you have CI/CD

   - [x] **Require branches to be up to date before merging**
     - Ensures no conflicts

   - [x] **Do not allow bypassing the above settings**
     - Applies rules even to admins (you can override if needed)

   - [x] **Lock branch** (extreme - not recommended for active development)
     - Makes branch read-only

4. **Click "Create" to Save**

### How This Protects You:

```
âŒ BLOCKED: Direct commit to main
âœ… ALLOWED: Create dev branch â†’ Make changes â†’ Open PR â†’ Review â†’ Merge to main
```

**With AI Studio:**
```
AI Studio modifies code â†’ Commits to dev branch â†’ You review on GitHub â†’
Create Pull Request â†’ Review changes â†’ Approve & Merge â†’ main branch updated
```

---

## ðŸ”¥ Part 2: Separate Firebase Environments (Highly Recommended)

Create two Firebase projects: one for development, one for production.

### Why Two Environments?

| Aspect | Development | Production |
|--------|------------|------------|
| **Purpose** | Testing AI Studio changes | Live website for users |
| **URL** | `https://gwnct-dev.web.app` | `https://gen-lang-client-0242565142.web.app` |
| **Git Branch** | `dev` | `main` |
| **Database** | Test data, can break | Real user data |
| **Mistakes** | Safe to make | Must avoid |
| **Deploy Frequency** | Many times per day | Only after thorough testing |

---

### Step-by-Step Setup:

#### A. Create Development Firebase Project

1. **Go to Firebase Console**
   - Navigate to: https://console.firebase.google.com
   - Click **"Add project"** (or **"Create a project"**)

2. **Project Setup**
   - **Project name**: `gwnct-dev` (or `wnc-times-dev`)
   - **Google Analytics**: Yes (optional, recommended)
   - Click **"Create project"**

3. **Register Web App**
   - In the new project, click the **</> (Web)** icon
   - **App nickname**: "GWNCT Dev"
   - **Firebase Hosting**: âœ… Check this box
   - Click **"Register app"**

4. **Copy Firebase Config**
   - Copy the config object that appears:
   ```javascript
   const firebaseConfig = {
     apiKey: "AIzaSy...",
     authDomain: "gwnct-dev.firebaseapp.com",
     projectId: "gwnct-dev",
     storageBucket: "gwnct-dev.appspot.com",
     messagingSenderId: "...",
     appId: "...",
     measurementId: "..."
   };
   ```
   - Save this somewhere (you'll need it later)

5. **Enable Firestore Database**
   - Go to **Build** â†’ **Firestore Database**
   - Click **"Create database"**
   - **Start mode**: Production mode (recommended) or Test mode
   - **Location**: `us-central` (or your preferred region)
   - Click **"Enable"**

6. **Create Named Database (Important!)**
   - In Firestore, click the **"â‹®"** menu next to "(default)"
   - Select **"Create database"**
   - **Database ID**: `gwnct` (must match your production)
   - Click **"Create"**

7. **Enable Hosting**
   - Go to **Build** â†’ **Hosting**
   - Click **"Get started"**
   - Follow the setup wizard (you'll configure this in the terminal)

---

#### B. Configure Local Project for Multiple Environments

Now we'll set up your local project to support both environments.

##### 1. Update `.firebaserc` File

Open `c:\dev\wnc-times-clone\.firebaserc` and update it:

```json
{
  "projects": {
    "default": "gen-lang-client-0242565142",
    "production": "gen-lang-client-0242565142",
    "dev": "gwnct-dev"
  },
  "targets": {},
  "etags": {}
}
```

**What this does:**
- `default`: Points to production (safe default)
- `production`: Explicit alias for production project
- `dev`: New development environment

##### 2. Create Environment-Specific Firebase Config Files

Create a new file: `c:\dev\wnc-times-clone\firebase.config.dev.ts`

```typescript
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: 'YOUR_DEV_API_KEY_HERE',
  authDomain: 'gwnct-dev.firebaseapp.com',
  projectId: 'gwnct-dev',
  storageBucket: 'gwnct-dev.appspot.com',
  messagingSenderId: 'YOUR_DEV_MESSAGING_ID',
  appId: 'YOUR_DEV_APP_ID',
  measurementId: 'YOUR_DEV_MEASUREMENT_ID',
};

const app = initializeApp(firebaseConfig);

// Point at the named Firestore database 'gwnct' (same as production)
export const db = getFirestore(app, 'gwnct');
```

**Keep your existing production file:** `firebase.ts` (don't change it)

##### 3. Add Environment Switching to Vite Config

Update `c:\dev\wnc-times-clone\vite.config.ts`:

```typescript
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, '.', '');

  return {
    server: {
      port: 3000,
      host: '0.0.0.0',
    },
    plugins: [react()],
    define: {
      'process.env.API_KEY': JSON.stringify(env.VITE_GEMINI_API_KEY),
      'process.env.NODE_ENV': JSON.stringify(mode), // Add this
    },
    resolve: {
      alias: {
        '@': path.resolve(__dirname, '.'),
        // Use different firebase config based on environment
        '@/firebase': path.resolve(__dirname, mode === 'development' ? 'firebase.config.dev.ts' : 'firebase.ts')
      }
    }
  };
});
```

---

#### C. Deploy to Development Environment

##### 1. Switch to Dev Environment

```bash
# Switch to dev Firebase project
firebase use dev

# Verify you're on the right project
firebase projects:list
# Should show "gwnct-dev" with (current) next to it
```

##### 2. Switch to Dev Git Branch

```bash
git checkout dev
```

##### 3. Build and Deploy

```bash
# Install dependencies (if needed)
npm install

# Build the project
npm run build

# Deploy to dev environment
firebase deploy

# You should see: "Deploying to 'gwnct-dev'..."
```

##### 4. Access Dev Site

After deployment completes, you'll see:
```
âœ”  Deploy complete!

Project Console: https://console.firebase.google.com/project/gwnct-dev/overview
Hosting URL: https://gwnct-dev.web.app
```

Visit `https://gwnct-dev.web.app` to test!

---

### Daily Development Workflow

#### Working on Features (Safe):

```bash
# 1. Make sure you're on dev branch
git checkout dev

# 2. Switch to dev Firebase
firebase use dev

# 3. Start local development
npm run dev
# Test at http://localhost:3000

# 4. Make changes, test locally

# 5. Commit changes
git add .
git commit -m "Add new feature"

# 6. Push to GitHub
git push origin dev

# 7. Deploy to dev environment (optional, for remote testing)
npm run build
firebase deploy
# Visit https://gwnct-dev.web.app
```

#### Deploying to Production (After Testing):

```bash
# 1. Switch to main branch
git checkout main

# 2. Merge dev into main (or use GitHub Pull Request)
git merge dev

# 3. Switch to production Firebase
firebase use production

# 4. Build production version
npm run build

# 5. Deploy to production
firebase deploy

# 6. Push main branch to GitHub
git push origin main
```

---

## ðŸ“Š Quick Reference Commands

### Firebase Project Switching

```bash
# List all projects
firebase projects:list

# Switch to dev
firebase use dev

# Switch to production
firebase use production

# Check current project
firebase use
```

### Git Branch Operations

```bash
# Check current branch
git branch

# Switch to dev
git checkout dev

# Switch to main
git checkout main

# Create and switch to new feature branch
git checkout -b feature/new-feature

# Merge dev into main
git checkout main
git merge dev
```

### Deployment Commands

```bash
# Deploy to current Firebase project
firebase deploy

# Deploy only hosting (faster)
firebase deploy --only hosting

# Deploy only Firestore rules
firebase deploy --only firestore:rules

# Preview deployment (doesn't deploy)
firebase hosting:channel:deploy preview
```

---

## ðŸš¨ Safety Checklist Before Production Deploy

Before deploying to production, verify:

- [ ] All features tested on dev environment (`https://gwnct-dev.web.app`)
- [ ] Local build works: `npm run build` (no errors)
- [ ] Currently on `main` branch: `git branch`
- [ ] Currently using production Firebase: `firebase use`
- [ ] All changes committed and pushed to GitHub
- [ ] Database backup downloaded (Admin â†’ Infrastructure â†’ Download Backup)
- [ ] API keys configured in production settings
- [ ] No console errors in browser dev tools

---

## ðŸ”’ Security Best Practices

### Environment Variables

Create separate `.env` files for each environment:

**`.env.development` (for dev):**
```env
VITE_GEMINI_API_KEY=your_dev_gemini_key
VITE_FIREBASE_PROJECT=gwnct-dev
```

**`.env.production` (for production):**
```env
VITE_GEMINI_API_KEY=your_production_gemini_key
VITE_FIREBASE_PROJECT=gen-lang-client-0242565142
```

**Add to `.gitignore`:**
```
.env
.env.local
.env.development
.env.production
```

### Firestore Security Rules

Create separate security rules for dev and production:

**Development (lenient for testing):**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true; // Open for testing
    }
  }
}
```

**Production (strict):**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read: if true; // Public read
      allow write: if request.auth != null; // Authenticated write only
    }
  }
}
```

---

## ðŸ†˜ Troubleshooting

### Issue: "Permission denied" when deploying
**Solution:** Make sure you're logged into Firebase CLI:
```bash
firebase login
firebase projects:list
```

### Issue: Wrong Firebase project deployed
**Solution:** Always verify before deploying:
```bash
firebase use  # Check current project
firebase use dev  # Switch if needed
```

### Issue: Can't switch branches (uncommitted changes)
**Solution:** Commit or stash changes first:
```bash
git stash  # Temporarily save changes
git checkout main
git stash pop  # Restore changes
```

### Issue: Build fails on production
**Solution:** Clean and rebuild:
```bash
rm -rf node_modules dist
npm install
npm run build
```

---

## ðŸ“ž AI Studio Integration

When connecting AI Studio to your repository:

### Recommended Settings:
- **Repository**: `https://github.com/carlucci001/gwnct-core.git`
- **Branch**: `dev` (always!)
- **Auto-deploy**: Disabled (you control deployments manually)
- **Environment**: Development (test on https://gwnct-dev.web.app)

### AI Studio Workflow:
```
1. AI Studio makes changes â†’ Commits to dev branch on GitHub
2. You pull changes: git pull origin dev
3. You test locally: npm run dev
4. You deploy to dev: firebase use dev && firebase deploy
5. You test on https://gwnct-dev.web.app
6. If good: Merge dev â†’ main via GitHub PR
7. You deploy to production: firebase use production && firebase deploy
```

**Your production NEVER updates unless YOU deploy it manually.**

---

## âœ… Summary

### What We Set Up:

1. **GitHub Branch Protection**
   - `main` branch requires pull requests
   - Prevents accidental direct commits
   - All changes reviewed before merging

2. **Two Firebase Environments**
   - **Dev**: `https://gwnct-dev.web.app` (test everything here)
   - **Production**: `https://gen-lang-client-0242565142.web.app` (live site)

3. **Safe Workflow**
   - AI Studio â†’ `dev` branch â†’ Test on dev Firebase â†’ Review â†’ Merge to `main` â†’ Deploy to production

### Your Protection:

- âœ… `main` branch is protected by GitHub rules
- âœ… Production Firebase requires manual deployment
- âœ… Dev environment for safe testing
- âœ… All changes go through review process
- âœ… You control every production deployment

**Bottom Line:** Even if AI Studio goes rogue, your production site and `main` branch are 100% safe. Nothing deploys without your explicit action.

---

**Ready to set this up? Follow the steps in order, and you'll have bulletproof protection for your production environment!**


--- FILE: C:\dev\wnct-next\old_react_mds\DEVELOPMENT_GUIDE.md ---
# Development Guide - WNC Times

## Quick Reference for Common Issues

### Browser Cache Issues (Layout Not Updating)

If you make changes but don't see them reflected in the browser:

#### Method 1: Hard Refresh (Try This First)
- **Windows/Linux**: `Ctrl + Shift + R` or `Ctrl + F5`
- **Mac**: `Cmd + Shift + R`

#### Method 2: Clear Cache and Reload
1. Press `F12` to open DevTools
2. Right-click the refresh button
3. Select **"Empty Cache and Hard Reload"**

#### Method 3: Manual Cache Clear
1. Press `F12` to open DevTools
2. Go to **Application** tab (Chrome) or **Storage** tab (Firefox)
3. Under "Storage", click **"Clear site data"**
4. Refresh the page

#### Method 4: Clear Vite Cache and Restart
```bash
# Clear Vite's build cache
rm -rf node_modules/.vite

# Restart the dev server
npm run dev
```

### Verifying Changes Are Applied

To verify a specific component has updated:

1. **Open DevTools** (`F12`)
2. **Inspect the element** you modified
3. **Check for the changes** in the HTML/CSS
4. **Look at the Console** for any errors that might prevent loading

For the Admin Dashboard specifically, check if the `<main>` element has:
- Class: `max-w-[1800px] mx-auto px-4 md:px-6 py-6`
- Data attribute: `data-layout="constrained-v2"`

### Hot Module Replacement (HMR) Issues

If HMR stops working:

1. **Check the dev server terminal** for errors
2. **Restart the dev server**:
   ```bash
   # Stop with Ctrl+C, then:
   npm run dev
   ```

3. **If multiple servers are running**, kill all and start fresh:
   ```bash
   # Windows
   taskkill /F /IM node.exe

   # Mac/Linux
   killall node

   # Then restart
   npm run dev
   ```

### Git Best Practices

Before making significant changes:

1. **Check current status**:
   ```bash
   git status
   ```

2. **Create a checkpoint** (if needed):
   ```bash
   git add .
   git commit -m "Checkpoint before [description]"
   ```

3. **View recent changes**:
   ```bash
   git diff
   ```

### Common Development Workflows

#### Making Layout Changes

1. **Locate the file** you need to modify
2. **Read the file** to understand the structure
3. **Make the change** using your editor
4. **Wait for HMR** to update (watch terminal for "hmr update")
5. **Hard refresh browser** if changes don't appear
6. **Test thoroughly** at different screen sizes

#### Testing Responsive Design

1. Open DevTools (`F12`)
2. Click the device toolbar icon (or `Ctrl + Shift + M`)
3. Test these breakpoints:
   - **Mobile**: 375px (iPhone SE)
   - **Tablet**: 768px (iPad)
   - **Desktop**: 1024px, 1440px, 1920px

#### Debugging Authentication Issues

1. **Open DevTools Console** (`F12`)
2. **Check localStorage**:
   ```javascript
   // In browser console
   localStorage.getItem('wnc_users')
   localStorage.getItem('wnc_current_user')
   ```

3. **Clear auth data** (if needed):
   ```javascript
   localStorage.removeItem('wnc_users')
   localStorage.removeItem('wnc_current_user')
   ```

4. **Refresh** and login again

### Project Structure

```
wnc-times-clone/
â”œâ”€â”€ components/          # Reusable React components
â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ ProtectedRoute.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ pages/              # Page components
â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â”œâ”€â”€ Home.tsx
â”‚   â”œâ”€â”€ Login.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/           # Business logic & utilities
â”‚   â”œâ”€â”€ auth.ts         # Authentication service
â”‚   â”œâ”€â”€ googleAuth.ts   # Google OAuth
â”‚   â””â”€â”€ ...
â”œâ”€â”€ data/               # Static data & configurations
â”‚   â”œâ”€â”€ rolePermissions.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ types.ts            # TypeScript type definitions
â””â”€â”€ App.tsx             # Main app component & routing
```

### Environment Variables

Required variables in `.env`:

```bash
# Firebase Configuration (for Google OAuth - Optional)
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_domain.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_bucket.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
```

**Note**: Never commit `.env` - it's already in `.gitignore`

### VSCode Settings

The project includes `.vscode/settings.json` with:
- Auto-save delay to prevent constant HMR triggers
- TypeScript and ESLint configurations
- Optimized file watching excludes
- Format on save enabled

### Performance Tips

1. **Limit console.logs** in production code
2. **Use React DevTools** to profile components
3. **Check bundle size** with build analysis:
   ```bash
   npm run build
   # Check dist/ folder size
   ```

4. **Optimize images** before adding to media library
5. **Use lazy loading** for heavy components (if needed)

### Troubleshooting Checklist

When something goes wrong:

- [ ] Clear browser cache (hard refresh)
- [ ] Check browser console for errors
- [ ] Check terminal for build errors
- [ ] Verify HMR is working (watch for "hmr update" messages)
- [ ] Restart dev server
- [ ] Clear Vite cache (`rm -rf node_modules/.vite`)
- [ ] Check if multiple dev servers are running
- [ ] Verify file changes are saved
- [ ] Check git status to see what actually changed
- [ ] Look for TypeScript errors in IDE

### Getting Help

1. **Check the guides**:
   - [AUTHENTICATION_GUIDE.md](AUTHENTICATION_GUIDE.md) - Auth & user management
   - [FIREBASE_SETUP.md](FIREBASE_SETUP.md) - Google OAuth setup
   - [ROLES_PERMISSIONS_STRUCTURE.md](ROLES_PERMISSIONS_STRUCTURE.md) - Permissions matrix

2. **Check browser console** for error messages
3. **Check terminal output** for build errors
4. **Verify environment variables** are set correctly

### Code Quality Guidelines

1. **Always read before editing** - Use Read tool to understand context
2. **Test changes immediately** - Don't batch multiple changes
3. **Use TypeScript types** - Don't use `any` unless necessary
4. **Follow existing patterns** - Keep code consistent
5. **Comment complex logic** - But prefer self-documenting code
6. **Mobile-first design** - Start with mobile, scale up

### Admin Dashboard Specific Notes

The Admin Dashboard ([pages/AdminDashboard.tsx](pages/AdminDashboard.tsx)) uses:

- **Max width constraint**: `max-w-[1800px]` prevents excessive stretching
- **Responsive padding**: `px-4 md:px-6` adjusts for screen size
- **Centered layout**: `mx-auto` centers content within viewport
- **Flex layout**: Sidebar + main content area using flexbox
- **Tab-based navigation**: Multiple render functions for different sections

**Key sections**:
- Lines 4070-4128: Sidebar navigation
- Lines 4130-4152: Main content area with width constraint
- Lines 4154+: Modal overlays (article editor, media picker)

### Known Limitations & Future Improvements

- Authentication is client-side only (localStorage)
- No backend API - all data in browser storage
- No real email service - password reset simulated
- No rate limiting on login attempts
- Images stored as base64 (size limitations)

See [AUTHENTICATION_GUIDE.md](AUTHENTICATION_GUIDE.md) for migration recommendations.

---

**Last Updated**: 2025-12-05
**Project**: WNC Times Clone
**Stack**: React 19, TypeScript, Vite, Tailwind CSS


--- FILE: C:\dev\wnct-next\old_react_mds\FIREBASE_SETUP.md ---
# Firebase Setup for Google Sign-In

This guide will help you set up Google OAuth authentication using Firebase.

## Prerequisites

- A Google account
- Your WNC Times application running locally

## Step 1: Create a Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Click **"Add project"** or **"Create a project"**
3. Enter a project name (e.g., "WNC Times")
4. Click **Continue**
5. (Optional) Disable Google Analytics if you don't need it
6. Click **Create project**
7. Wait for the project to be created, then click **Continue**

## Step 2: Register Your App

1. In the Firebase console, click the **Web icon** (</>) to add a web app
2. Enter an app nickname (e.g., "WNC Times Web")
3. **Do NOT** check "Also set up Firebase Hosting"
4. Click **Register app**
5. You'll see your Firebase configuration - **keep this page open**

## Step 3: Enable Google Authentication

1. In the left sidebar, click **Build** â†’ **Authentication**
2. Click **Get started**
3. Click on the **Sign-in method** tab
4. Find **Google** in the providers list
5. Click on **Google** to configure it
6. Toggle the **Enable** switch to ON
7. Enter a **Project support email** (your email)
8. Click **Save**

## Step 4: Add Authorized Domains

1. Still in **Authentication** â†’ **Settings** tab
2. Scroll down to **Authorized domains**
3. Add your local development domain if needed:
   - `localhost` (should already be there)
   - Add your production domain when you deploy

## Step 5: Get Your Configuration

From the Firebase project settings, you'll need these values:

```javascript
{
  apiKey: "AIza...",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123:web:abc..."
}
```

## Step 6: Configure Your .env File

1. Copy `.env.example` to `.env`:
   ```bash
   cp .env.example .env
   ```

2. Edit `.env` and add your Firebase credentials:
   ```bash
   # Firebase Configuration (for Google OAuth)
   VITE_FIREBASE_API_KEY=AIza...
   VITE_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
   VITE_FIREBASE_PROJECT_ID=your-project-id
   VITE_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
   VITE_FIREBASE_MESSAGING_SENDER_ID=123456789
   VITE_FIREBASE_APP_ID=1:123:web:abc...
   ```

3. Save the file

## Step 7: Restart Your Development Server

1. Stop your current dev server (Ctrl+C)
2. Restart it:
   ```bash
   npm run dev
   ```

## Step 8: Test Google Sign-In

1. Go to [http://localhost:3000/#/login](http://localhost:3000/#/login)
2. Click the **"Sign in with Google"** button
3. Choose your Google account
4. You should be redirected and logged in!

## Troubleshooting

### "Pop-up blocked by browser"
- Enable pop-ups for your localhost in browser settings
- Some browsers block pop-ups by default

### "This app is not verified"
- During development, you'll see this warning
- Click **"Advanced"** â†’ **"Go to [your-app] (unsafe)"**
- For production, you'll need to verify your app with Google

### "Google Sign-In is not configured"
- Make sure all 6 `VITE_FIREBASE_*` variables are set in `.env`
- Restart your dev server after changing `.env`
- Check browser console for any errors

### Still not working?
1. Check that all environment variables are set correctly
2. Verify Google authentication is enabled in Firebase Console
3. Check browser console for error messages
4. Make sure you're using the correct Firebase project

## Security Notes

- **Never commit your `.env` file** - it contains sensitive API keys
- The `.env` file is already in `.gitignore`
- For production deployment, set these as environment variables in your hosting platform
- Firebase API keys are safe to expose in client-side code (they're restricted by domain)

## Next Steps

Once Google Sign-In is working:
- Test registration with a new Google account
- Verify users get the "Commenter" role by default
- Check the Admin Dashboard â†’ Users to see new Google users
- Consider adding other OAuth providers (GitHub, Twitter, etc.)

## Production Deployment

When deploying to production:

1. Add your production domain to Firebase **Authorized domains**
2. Set environment variables in your hosting platform:
   - Vercel: Project Settings â†’ Environment Variables
   - Netlify: Site Settings â†’ Build & deploy â†’ Environment
   - Firebase Hosting: Use `firebase functions:config:set`

3. Update OAuth consent screen in Google Cloud Console if needed

## Learn More

- [Firebase Authentication Docs](https://firebase.google.com/docs/auth)
- [Google Sign-In for Websites](https://developers.google.com/identity/sign-in/web)
- [WNC Times Authentication Guide](./AUTHENTICATION_GUIDE.md)

---

**Need help?** Check the [Authentication Guide](./AUTHENTICATION_GUIDE.md) or open an issue.


--- FILE: C:\dev\wnct-next\old_react_mds\HANDOFF_CHECKPOINT.md ---
# Handoff Checkpoint - 2025-12-09
  
You asked for a clear restore point before I proceed. This file marks the handoff state I received (no changes applied yet).

- Workspace: `c:\dev\wnc-times-clone`
- Git: Not available in this environment (no `.git` directory or `git` binary detected), so a commit cannot be created here. Use this checkpoint note to return to the pre-change state.
- Key context read: `AI_HANDOFF.md`, `SESSION_ANALYSIS.md`, `App.tsx`, `types.ts`, `services/auth.ts`, `pages/admin/components/InfrastructureSection.tsx`.
- Known constraints: IndexedDB `DB_VERSION` must stay at 8; Firestore (`gwnct`/`articles`) is the source of truth; Admin user `admin/admin123` auto-initializes.

If you add git later, create a restore tag/commit from this state:
1) `git init` (if repo absent), then add/commit current tree with message `chore: checkpoint before codex changes`.
2) Tag it `checkpoint-2025-12-09-before-codex`.

Next planned actions (pending your confirmation):
- Apply best-practice tightening in InfrastructureSection (e.g., ensure restores also sync to Firestore, guardrails on bulk operations, clearer logging).
- Add a brief handoff annotation in `AI_HANDOFF.md` pointing to this checkpoint.

If you prefer a different restore marker (e.g., new tag name or file), let me know before I continue.


--- FILE: C:\dev\wnct-next\old_react_mds\HOW-TO-USE-CONTINUE.md ---
# How to Use Continue with Gemini in VS Code

## âš ï¸ IMPORTANT: You're Using the Wrong Chat

**The error you're seeing is from GitHub Copilot, NOT Continue.**

Copilot doesn't support Gemini. You need to use the **Continue extension** instead.

---

## Visual Guide: Where to Find Continue

### Step 1: Look at Your Left Sidebar

In VS Code, look at the **left sidebar** with icons. You should see:

```
ðŸ“ Files (Explorer)
ðŸ” Search
ðŸŒ¿ Source Control
â–¶ï¸ Run and Debug
ðŸ“¦ Extensions
ðŸ¤– Continue  â† THIS IS THE ONE YOU WANT!
```

The **Continue icon** looks like a **triangle/play button** or **chat bubble**.

---

## Step 2: Open Continue Chat (3 Ways)

### Method 1: Keyboard Shortcut (Fastest)
Press: **`Ctrl+L`** (Control + letter L)

### Method 2: Click the Icon
Click the **Continue icon** in the left sidebar

### Method 3: Command Palette
1. Press `Ctrl+Shift+P`
2. Type: "Continue: Open Chat"
3. Press Enter

---

## What You Should See

When you open Continue correctly, you'll see:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Continue                      [x]   â”‚  â† Header says "Continue"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ¤– Gemini 2.0 Flash    [â–¼]         â”‚  â† Model selector
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ Chat history appears here...        â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type your message here...       [â†‘] â”‚  â† Text input
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## If You See "Copilot" Instead

**You're in the wrong chat!** Close it and use Continue instead.

### Close Copilot:
1. Click the X on the Copilot chat panel
2. Look for the **Continue icon** in left sidebar
3. Click it or press `Ctrl+L`

---

## Test That It's Working

Type this in the Continue chat:
```
What model are you?
```

**Expected response:**
"I am Gemini 2.0 Flash Experimental, a large language model by Google..."

**If you see "GPT-4" or "OpenAI":**
You're still in Copilot chat. Close it and open Continue.

---

## Differences Between Copilot and Continue

| Feature | GitHub Copilot | Continue |
|---------|----------------|----------|
| **Header Text** | "GitHub Copilot" | "Continue" |
| **Model** | GPT-4 (OpenAI) | Gemini 2.0 (Google) |
| **Cost** | $10/month | Free (uses your API key) |
| **Model Selector** | Dropdown with GPT models | Dropdown shows "Gemini 2.0 Flash" |
| **Error You Got** | "image media type required" | No errors |
| **Left Sidebar Icon** | Copilot logo (looks like ><) | Continue logo (triangle) |

---

## Visual: Where is Continue?

### Your Left Sidebar Should Look Like:

```
â”Œâ”€â”€â”€â”€â”
â”‚ ðŸ“ â”‚  â† Files
â”œâ”€â”€â”€â”€â”¤
â”‚ ðŸ” â”‚  â† Search
â”œâ”€â”€â”€â”€â”¤
â”‚ ðŸŒ¿ â”‚  â† Git
â”œâ”€â”€â”€â”€â”¤
â”‚ ðŸ› â”‚  â† Debug
â”œâ”€â”€â”€â”€â”¤
â”‚ ðŸ“¦ â”‚  â† Extensions
â”œâ”€â”€â”€â”€â”¤
â”‚ >< â”‚  â† Copilot (DON'T USE THIS)
â”œâ”€â”€â”€â”€â”¤
â”‚ â–¶ï¸ â”‚  â† Continue (USE THIS!) âœ“
â””â”€â”€â”€â”€â”˜
```

**Click the â–¶ï¸ icon to open Continue chat.**

---

## Still Can't Find It?

### Option 1: Reload VS Code
```
1. Press Ctrl+Shift+P
2. Type: "Reload Window"
3. Press Enter
4. Look for Continue icon in left sidebar
```

### Option 2: Check Extensions
```
1. Press Ctrl+Shift+X (Extensions)
2. Search: "Continue"
3. Make sure "Continue" extension is installed
4. Click "Reload Required" if you see it
```

### Option 3: Restart VS Code
```
1. Close VS Code completely
2. Reopen it
3. Look for Continue icon
```

---

## Once You Find Continue

### Try These Commands:

```
"Explain what Header.tsx does"
"Show me how to add a button to the navigation"
"What's the difference between React hooks?"
```

---

## Common Mistakes

### âŒ Wrong: Using Copilot Chat
- Header says "GitHub Copilot"
- Shows GPT-4 model
- Gives image errors

### âœ… Correct: Using Continue Chat
- Header says "Continue"
- Shows "Gemini 2.0 Flash"
- No errors

---

## If Continue Icon is Missing

Run this command in terminal:

```bash
code --install-extension continue.continue
```

Then reload VS Code (`Ctrl+Shift+P` â†’ "Reload Window")

---

## Keyboard Shortcuts Cheat Sheet

| Action | Shortcut |
|--------|----------|
| **Open Continue Chat** | `Ctrl+L` |
| **Close Chat** | `Escape` |
| **Clear Chat** | Click trash icon |
| **New Chat** | Click + icon |
| **Switch Model** | Click model name dropdown |

---

## What to Do If You See Errors

### Error: "No API key configured"
**Solution:** Your API key is already configured. Just reload VS Code.

### Error: "Model not found"
**Solution:** The config file needs to be updated. Let me know.

### Error: "Rate limit exceeded"
**Solution:** You're making too many requests. Wait 1 minute.

### Error: "Invalid API key"
**Solution:** Your Gemini API key might have expired. Check Google AI Studio.

---

## Disable Copilot (Optional)

If you want to disable Copilot to avoid confusion:

```
1. Press Ctrl+Shift+X (Extensions)
2. Search: "GitHub Copilot"
3. Click "Disable"
4. Reload VS Code
```

---

## Final Checklist

Before asking for help, verify:

- [ ] Continue extension is installed (`Ctrl+Shift+X` â†’ Search "Continue")
- [ ] VS Code has been reloaded (`Ctrl+Shift+P` â†’ "Reload Window")
- [ ] Continue icon appears in left sidebar
- [ ] Pressing `Ctrl+L` opens Continue chat
- [ ] Chat header says "Continue" (not "Copilot")
- [ ] Model dropdown shows "Gemini 2.0 Flash"

---

## Success!

Once you see the Continue chat panel with "Gemini 2.0 Flash" at the top, you're ready to go!

**Try it now:**
1. Press `Ctrl+L`
2. Type: "Hello, are you Gemini?"
3. Press Enter

You should get a response from Gemini 2.0!

---

## Need More Help?

If Continue still isn't showing up:
1. Take a screenshot of your VS Code window
2. Show me what icons you see in the left sidebar
3. Tell me what happens when you press `Ctrl+L`

I'll help you troubleshoot!


--- FILE: C:\dev\wnct-next\old_react_mds\PROJECT_STRUCTURE.md ---
# WNC Times - Clean Project Structure

**Git Commit:** 5e905d7 (v1.0-stable) â­ STABLE RESTORE POINT
**Live URL:** https://gen-lang-client-0242565142.web.app
**Date:** December 3, 2025

## Project Overview
A news website for Western North Carolina built with React, Firebase, and Vite.

## Core Technologies
- **React 19.2.0** - UI framework
- **Vite 6.4.1** - Build tool
- **Firebase Firestore** - Database (named database: 'gwnct')
- **Tailwind CSS** - Styling (via CDN)
- **TypeScript** - Type safety
- **HashRouter** - Client-side routing

## Key Files

### Configuration
- `firebase.ts` - Firebase initialization (connects to named database 'gwnct')
- `vite.config.ts` - Vite build configuration
- `package.json` - Dependencies
- `.firebaserc` - Firebase project ID
- `firebase.json` - Firebase hosting config

### Application Entry
- `index.html` - HTML entry point with Tailwind CDN and importmap
- `index.tsx` - React root
- `App.tsx` - Main app component with routes

### Services
- `services/api.ts` - Firestore data fetching (articles, categories, homepage)
- `services/db.ts` - IndexedDB caching layer (graceful fallback on errors)
- `services/firebase.ts` - REMOVED (was duplicate, now only use root firebase.ts)

### Pages
- `pages/Home.tsx` - Homepage with hero, articles, events
- `pages/Articles.tsx` - Article listing with filters
- `pages/ArticleDetail.tsx` - Single article view
- `pages/About.tsx` - About page
- `pages/Contact.tsx` - Contact page
- `pages/AdminDashboard.tsx` - Admin CMS

### Components
- `components/Header.tsx` - Navigation header
- `components/Footer.tsx` - Site footer
- `components/HeroSection.tsx` - Homepage hero
- `components/ArticleCard.tsx` - Article preview card
- `components/Sidebar.tsx` - Trending/categories sidebar
- `components/DirectoryCard.tsx` - Business directory card
- `components/Breadcrumbs.tsx` - Navigation breadcrumbs
- Plus more...

### Data
- `data/articles.json` - Fallback mock articles
- `types.ts` - TypeScript type definitions

## Firebase Structure

### Firestore Collections
- `articles` - All news articles (465+ documents)
- `categories` - Article categories (6 default categories)

### Named Database
- Database ID: `gwnct`
- Must use: `getFirestore(app, 'gwnct')`

## IndexedDB Caching
- Database: `wnc_platform_db`
- Version: 5
- Stores: articles, categories, comments, settings
- **Graceful degradation** - Falls back to Firestore if IndexedDB fails

## Build & Deploy

### Development
```bash
npm run dev  # Runs on http://localhost:3000
```

### Production Build
```bash
npm run build  # Outputs to dist/
```

### Deploy
```bash
firebase deploy --only hosting
```

## Important Notes

### Version Control
- **Always commit working state before major changes**
- **â­ STABLE RESTORE POINT: `5e905d7` (v1.0-stable)** - USE THIS TO RESTORE
- Previous commits: `e2d14f7`, `b417d0c`, `41a59b7`, `c552e18`, `f5033a6`

### Database Configuration
- Must use named database 'gwnct' in firebase.ts
- WRONG: `getFirestore(app)` - connects to (default) database
- RIGHT: `getFirestore(app, 'gwnct')` - connects to gwnct database

### Common Issues
1. **IndexedDB errors** - Normal if browser blocks it, app falls back to Firestore
2. **Build fails on index.html** - Check for inline `<style>` tags or missing CSS references
3. **0 articles from Firestore** - Check database name in firebase.ts

## Files Removed (Not Needed)
- All `.cjs` migration/debug scripts
- `src/` folder (AI-related TypeScript types)
- `.env` file (Gemini API key)
- `index.css` / `index.html.backup`
- AI-related code (Gemini, RelatedArticles component)

## How to Restore to This Point

If anything breaks in the future, restore to this stable version:

```bash
git reset --hard 5e905d7
# OR use the tag
git reset --hard v1.0-stable
```

Then rebuild and deploy:
```bash
npm run build
firebase deploy --only hosting
```


--- FILE: C:\dev\wnct-next\old_react_mds\README.md ---
# Gemini 3 Newspaper Platform (White Label Edition)

## Architecture Overview: The Franchise Model

This platform is built on a **Strict Franchise Architecture**. It separates the roles of the **Platform Owner (You)** from the **Tenant (Newspaper Owner)**.

### 1. The Platform HQ (Super Admin)
Tools reserved for you, the factory owner. These agents exist to deploy and manage the business of selling newspapers.
*   **Cloning Engine:** Spins up new instances (Infrastructure as Code).
*   **Partner Agent:** Manages onboarding, billing, and global analytics.

### 2. The Tenant Instance (The Product)
When a client buys a newspaper, they receive a self-contained environment populated with their own **AI Staff**.
*   **Master Agent (Local):** The Editor-in-Chief. It enforces the specific tone, geography, and audience of that single newspaper.
*   **Journalist Agent:** Writes content based on the Local Master's directives.
*   **Editor Agent:** Quality assurance.
*   **SEO & Social Agents:** Marketing and growth.
*   **Automation Agent:** Scans local data sources defined by the tenant.

## Tech Stack
*   **Frontend:** React 18, Tailwind CSS, Lucide Icons
*   **AI Core:** Google Gemini 2.5 Flash (Text), Gemini 2.5 Flash Image (Visuals), Google Search Grounding
*   **Backend (Simulated in this repo):** Cloud Run, Firestore (NoSQL)

## Deployment
1.  **Platform Owner:** Deploys the Master codebase.
2.  **New Tenant:** The `Cloning Engine` copies the base Docker image, injects a new `TENANT_ID`, and provisions a new Firestore root collection.
3.  **Configuration:** The Tenant uses the "Platform Configuration" tab in their dashboard to set their City, Radius, and Tone, which instantly retrains their local AI staff.

## Demo Accounts (localStorage)

Default admin (full access):
- Username: `admin`
- Password: `admin123`

Pre-seeded demo users (all passwords: `demo123`):
- Business Owner â€” `demo-business` (`demo-business@example.com`)
- Editor in Chief â€” `demo-eic` (`demo-eic@example.com`)
- Editor â€” `demo-editor` (`demo-editor@example.com`)
- Content Contributor â€” `demo-contributor` (`demo-contributor@example.com`)
- Commenter â€” `demo-commenter` (`demo-commenter@example.com`)
- Reader â€” `demo-reader` (`demo-reader@example.com`)
- Guest (suspended) â€” `demo-guest` (`demo-guest@example.com`)


--- FILE: C:\dev\wnct-next\old_react_mds\RECOMMENDED-DEV-SETUP.md ---
# Recommended Development Setup for Visual AI Workflow

## The Problem with AI Studio

AI Studio is **great for simple projects**, but struggles with:
- React projects with many dependencies
- Large TypeScript codebases
- Real-time preview rendering in browser

**Your project** (~40 files, React 19, TypeScript, Vite) hits all these limitations.

---

## Best Alternative: Cursor IDE

### What is Cursor?

Cursor is a **VS Code fork** built specifically for AI-assisted development. It gives you the **exact workflow you want**:

1. **Chat with AI** â†’ Request changes
2. **AI edits code** â†’ See changes in real-time
3. **Live preview** â†’ localhost:3000 auto-refreshes
4. **Iterate** â†’ Continue refining via chat

### Why Cursor is Perfect for Your Workflow

âœ… **Visual feedback** - Split screen: code + browser preview
âœ… **AI chat interface** - Just like AI Studio
âœ… **Multi-file editing** - AI can edit multiple files at once
âœ… **Fast** - Native performance, no browser limitations
âœ… **Gemini integration** - Use your own API key
âœ… **Git integration** - Commit directly from IDE

### Setup Instructions

#### 1. Download Cursor
- **Website:** https://cursor.sh
- **Free tier:** 50 AI requests/month
- **Pro tier:** $20/month unlimited

#### 2. Install Cursor
```bash
# Download installer for Windows
# Install like any application
```

#### 3. Open Your Project
```bash
# In Cursor: File â†’ Open Folder
# Navigate to: c:\dev\wnc-times-clone
```

#### 4. Configure Gemini API
```
1. Cursor Settings (Ctrl+,)
2. Search: "AI Provider"
3. Add Gemini API key from your .env file
4. Select model: gemini-1.5-pro or gemini-2.0-flash
```

#### 5. Start Development Server
```bash
# In Cursor terminal (Ctrl+`)
npm run dev
```

#### 6. Open Preview
```
1. Open browser to: http://localhost:3000
2. Split screen: Cursor (left) + Browser (right)
3. Changes auto-refresh via Vite HMR
```

#### 7. Start Using AI Chat
```
Press: Ctrl+K (quick edit)
Or: Ctrl+L (chat sidebar)

Example requests:
- "Make the breaking news ticker scroll faster"
- "Add a dark mode toggle to the header"
- "Change the admin sidebar background to light blue"
```

---

## Free Alternative: Continue.dev

If you don't want to pay for Cursor, use **Continue.dev** extension in VS Code.

### Setup Instructions

#### 1. Install VS Code Extensions
```
1. Open VS Code
2. Install "Continue" extension
3. Install "Live Server" extension (optional)
```

#### 2. Configure Continue with Gemini
```
1. Open Continue settings (gear icon in Continue sidebar)
2. Add provider: Google Gemini
3. Paste your API key from .env
4. Select model: gemini-1.5-pro
```

#### 3. Development Workflow
```bash
# Terminal 1: Start dev server
npm run dev

# Browser: Open localhost:3000

# VS Code: Use Continue chat (Ctrl+L)
"Move the weather widget to the right"

# Browser auto-refreshes with changes
```

**Cost:** FREE (uses your Gemini API key - ~$0.01 per request)

---

## Comparison Table

| Feature | AI Studio | Cursor | Continue.dev | VS Code Copilot |
|---------|-----------|--------|--------------|-----------------|
| **Visual Preview** | âœ… Built-in | âœ… Via browser | âœ… Via browser | âœ… Via browser |
| **AI Chat** | âœ… Built-in | âœ… Built-in | âœ… Built-in | âœ… Built-in |
| **Multi-file Editing** | âœ… | âœ… | âœ… | âœ… |
| **Performance** | âŒ Slow for React | âœ… Fast | âœ… Fast | âœ… Fast |
| **Cost** | Free | $20/month | Free | $10/month |
| **AI Provider** | Google | Multiple | Gemini/Claude/GPT | OpenAI |
| **Git Integration** | âŒ Limited | âœ… Full | âœ… Full | âœ… Full |
| **Local File Access** | âŒ Clones repo | âœ… Direct | âœ… Direct | âœ… Direct |

---

## Your Ideal Workflow

### Morning Setup
```bash
# 1. Open Cursor
cursor c:\dev\wnc-times-clone

# 2. Start dev server
npm run dev

# 3. Open browser
# Navigate to: http://localhost:3000

# 4. Arrange windows
# Left: Cursor (50% width)
# Right: Browser (50% width)
```

### Making Changes
```
You: "Add a search icon to the header navigation"

Cursor AI:
- Opens components/Header.tsx
- Adds import for Search icon
- Adds search button to navigation
- Shows you the diff

You: "Make it bigger and gold colored"

Cursor AI:
- Updates className
- Adds text-brand-gold
- Increases icon size

Browser: Auto-refreshes, shows changes instantly
```

### Committing Changes
```bash
# In Cursor terminal
git add .
git commit -m "Add search icon to header"
git push origin dev
```

---

## Why This is Better Than AI Studio

### AI Studio Limitations:
1. **Slow** - Compiles code in browser (heavy)
2. **Limited preview** - iframe restrictions
3. **No direct file access** - Must clone repo
4. **Browser memory limits** - Can crash on large projects
5. **Network dependent** - Slow uploads/downloads

### Cursor/Continue Advantages:
1. **Fast** - Native Node.js, no browser overhead
2. **Full control** - Direct file system access
3. **Better debugging** - Chrome DevTools, console.log works
4. **Larger context** - Can analyze entire codebase
5. **Git integration** - Commit/push directly
6. **Extensions** - Use any VS Code extension

---

## Installation Steps (Quick Start)

### Option 1: Cursor (Recommended)

```bash
# 1. Download
https://cursor.sh

# 2. Install application

# 3. Open project
cursor c:\dev\wnc-times-clone

# 4. Configure Gemini
Settings â†’ AI â†’ Add API Key

# 5. Start coding
npm run dev
Ctrl+L (open chat)
```

### Option 2: Continue.dev (Free)

```bash
# 1. Open VS Code
code c:\dev\wnc-times-clone

# 2. Install Continue extension
Ctrl+Shift+X â†’ Search "Continue" â†’ Install

# 3. Configure
Continue Settings â†’ Add Gemini provider

# 4. Start coding
npm run dev
Ctrl+L (open chat)
```

---

## Example Session with Cursor

```
Session Goal: Redesign admin dashboard sidebar

1. You: "Show me the admin sidebar code"
   â†’ Cursor opens pages/AdminDashboard.tsx

2. You: "Add icons to each menu item"
   â†’ Cursor adds import and updates JSX

3. You: "Make the active tab background blue"
   â†’ Cursor updates className

4. Browser auto-refreshes â†’ You see changes

5. You: "Actually make it purple"
   â†’ Cursor updates color

6. Browser refreshes â†’ Perfect!

7. Cursor: "git add . && git commit -m 'Update sidebar styling'"
   â†’ Changes committed
```

---

## Troubleshooting

### Issue: Cursor not showing AI responses
**Solution:** Check API key in Settings â†’ AI â†’ Models

### Issue: Browser not auto-refreshing
**Solution:** Make sure Vite dev server is running (`npm run dev`)

### Issue: Changes not appearing
**Solution:** Hard refresh browser (Ctrl+Shift+R)

### Issue: Cursor feels slow
**Solution:** Close other applications, restart Cursor

---

## Cost Analysis

### AI Studio
- **Cost:** Free
- **Performance:** Poor for your project
- **Frustration:** High (spinning, crashes)

### Cursor Pro
- **Cost:** $20/month
- **Performance:** Excellent
- **Time saved:** ~10 hours/month
- **Value:** $2/hour (worth it!)

### Continue.dev
- **Cost:** Free + Gemini API (~$5/month)
- **Performance:** Excellent
- **Best for:** Budget-conscious developers

### Recommendation
Start with **Continue.dev** (free) to test the workflow. If you love it, upgrade to **Cursor** for better AI features.

---

## Next Steps

1. **Install Cursor or Continue.dev** (30 minutes)
2. **Configure Gemini API** (5 minutes)
3. **Test with simple request** (10 minutes)
4. **Build muscle memory** (1 week)
5. **Never go back to AI Studio** (forever ðŸ˜„)

---

## Support & Resources

### Cursor
- **Docs:** https://cursor.sh/docs
- **Discord:** https://discord.gg/cursor
- **YouTube:** Search "Cursor IDE tutorial"

### Continue.dev
- **Docs:** https://continue.dev/docs
- **GitHub:** https://github.com/continuedev/continue
- **Discord:** https://discord.gg/continue

### Your Project
- **Local dev:** http://localhost:3000
- **Admin panel:** http://localhost:3000/#/admin
- **Repository:** https://github.com/carlucci001/gwnct-core

---

**Bottom Line:** Cursor (or Continue.dev) gives you the **exact AI Studio workflow** you want, but **100x faster** and with **better AI capabilities**. You'll never look back.


--- FILE: C:\dev\wnct-next\old_react_mds\ROLES_PERMISSIONS_STRUCTURE.md ---
# Roles & Permissions Structure

## User Roles Hierarchy

### 1. **Admin** (Highest Level)
- Full system access
- Can manage all users, roles, and permissions
- Access to all content, settings, and infrastructure
- Can delete/modify any content
- System configuration access

### 2. **Business Owner**
- Business-level access
- Can manage business settings and users within their organization
- View analytics and reports
- Manage subscriptions and billing
- Cannot access system infrastructure
- Can manage content contributors

### 3. **Editor-in-Chief** (Editorial Leadership)
- Manages editorial workflow
- Approves articles for publication
- Assigns stories to journalists
- Reviews and edits all content
- Cannot access business/financial settings
- Can manage journalists and content contributors

### 4. **Editor**
- Reviews and edits articles
- Can approve content for Editor-in-Chief review
- Assigns tasks to journalists
- Cannot publish directly (needs Editor-in-Chief approval)
- Limited user management

### 5. **Content Contributor** (Journalist/Writer)
- Creates and submits articles
- Can save drafts
- Cannot publish (must send to Editor)
- Limited to own content
- Can upload media

### 6. **Commenter**
- Can read all published content
- Can post and manage own comments
- No content creation access
- No admin panel access

### 7. **Reader** (Lowest Level)
- Read-only access to published content
- No commenting rights
- No admin panel access
- Public-facing only

## Users Section Menu Structure

```
Users (Main Section)
â”œâ”€â”€ All Users (List view with filters)
â”‚   â”œâ”€â”€ Search/Filter by role
â”‚   â”œâ”€â”€ Search by name/email
â”‚   â””â”€â”€ Bulk actions
â”‚
â”œâ”€â”€ Roles & Permissions
â”‚   â”œâ”€â”€ Role Management
â”‚   â”‚   â”œâ”€â”€ Create New Role
â”‚   â”‚   â”œâ”€â”€ Edit Existing Roles
â”‚   â”‚   â””â”€â”€ Delete Roles
â”‚   â””â”€â”€ Permission Matrix
â”‚       â”œâ”€â”€ Content Permissions
â”‚       â”œâ”€â”€ User Management Permissions
â”‚       â”œâ”€â”€ Settings Permissions
â”‚       â””â”€â”€ System Permissions
â”‚
â”œâ”€â”€ Add New User
â”‚   â”œâ”€â”€ Basic Info (name, email, password)
â”‚   â”œâ”€â”€ Assign Role
â”‚   â”œâ”€â”€ Set Permissions
â”‚   â””â”€â”€ Notification Preferences
â”‚
â””â”€â”€ User Activity Log
    â”œâ”€â”€ Login history
    â”œâ”€â”€ Content changes
    â””â”€â”€ Permission changes
```

## Permissions Matrix

### Content Permissions
| Permission | Admin | Business Owner | Editor-in-Chief | Editor | Content Contributor | Commenter | Reader |
|-----------|-------|----------------|-----------------|--------|-------------------|-----------|--------|
| Create Article | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| Edit Own Article | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| Edit Any Article | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| Delete Own Article | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| Delete Any Article | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| Publish Article | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| View Drafts | âœ… | âœ… | âœ… | âœ… | Own Only | âŒ | âŒ |
| Manage Comments | âœ… | âœ… | âœ… | âœ… | âŒ | Own Only | âŒ |

### User Management Permissions
| Permission | Admin | Business Owner | Editor-in-Chief | Editor | Content Contributor | Commenter | Reader |
|-----------|-------|----------------|-----------------|--------|-------------------|-----------|--------|
| Create Users | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| Edit Users | âœ… | âœ… | Limited | âŒ | âŒ | âŒ | âŒ |
| Delete Users | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| Assign Roles | âœ… | âœ… | Limited | âŒ | âŒ | âŒ | âŒ |
| View User Activity | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |

### Settings & System Permissions
| Permission | Admin | Business Owner | Editor-in-Chief | Editor | Content Contributor | Commenter | Reader |
|-----------|-------|----------------|-----------------|--------|-------------------|-----------|--------|
| Site Settings | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| API Configuration | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| Theme/Design | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| Categories | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| Tags | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| Media Library | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ |
| Infrastructure | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |

## User Profile Tab Structure

When clicking on a user, open a modal/panel with tabs:

```
User: John Doe
â”œâ”€â”€ Profile (Tab 1)
â”‚   â”œâ”€â”€ Avatar/Photo
â”‚   â”œâ”€â”€ Full Name
â”‚   â”œâ”€â”€ Email
â”‚   â”œâ”€â”€ Bio
â”‚   â””â”€â”€ Contact Info
â”‚
â”œâ”€â”€ Role & Permissions (Tab 2)
â”‚   â”œâ”€â”€ Current Role (dropdown)
â”‚   â”œâ”€â”€ Custom Permissions (checkboxes)
â”‚   â””â”€â”€ Permission History
â”‚
â”œâ”€â”€ Content (Tab 3)
â”‚   â”œâ”€â”€ Articles Created
â”‚   â”œâ”€â”€ Drafts
â”‚   â”œâ”€â”€ Published
â”‚   â””â”€â”€ Comments
â”‚
â”œâ”€â”€ Activity (Tab 4)
â”‚   â”œâ”€â”€ Login History
â”‚   â”œâ”€â”€ Recent Actions
â”‚   â””â”€â”€ Content Changes
â”‚
â””â”€â”€ Settings (Tab 5)
    â”œâ”€â”€ Email Notifications
    â”œâ”€â”€ Account Status (Active/Suspended)
    â”œâ”€â”€ Password Reset
    â””â”€â”€ Delete User
```

## Implementation Priority

1. **Phase 1**: Basic role selection (dropdown in user creation/edit)
2. **Phase 2**: Permission checks in code (can user do X?)
3. **Phase 3**: Role management UI
4. **Phase 4**: Custom permissions per user
5. **Phase 5**: Activity logging and audit trail


--- FILE: C:\dev\wnct-next\old_react_mds\SESSION-SUMMARY.md ---
# Development Session Summary
**Date**: 2025-12-03
**Branch**: `dev`
**Tag**: `v1.3-session-complete`
**Status**: âœ… All features working on localhost:3000

---

## ðŸŽ¯ Session Objectives - ALL COMPLETED

1. âœ… **Create git restore point** (`v1.1-weather-stable`)
2. âœ… **Reorganize admin left menu** - Collapsible hierarchical sections
3. âœ… **Create Integrations admin page** - API key management interface
4. âœ… **Fix UX issues** - Move Integrations up, add save confirmation, test button
5. âœ… **Fix breaking news alignment** - Align with logo margin
6. âœ… **Add Articles filtering/sorting** - Category, status, sortable columns, pagination
7. âœ… **CRITICAL: Fix sanitization persistence** - Articles no longer revert to dirty HTML

---

## ðŸš¨ CRITICAL BUG FIX: Article Sanitization Persistence

### Problem
User reported: "Every time you do another build, articles return to their dirty HTML state. I have to rerun Sanitize Content every time."

### Root Cause
The **restore function** was loading backup files **without cleaning HTML**. When users restored from old backups (created before sanitization), dirty HTML returned.

### Solution
Modified `pages/AdminDashboard.tsx:282-290` to automatically sanitize all articles during restore:

```typescript
// IMPORTANT: Always sanitize articles during restore to prevent dirty HTML from returning
if (data.articles) {
    const cleanedArticles = data.articles.map((article: Article) => ({
        ...article,
        content: cleanHTML(article.content || ''),
        excerpt: cleanHTML(article.excerpt || '')
    }));
    await dbService.saveArticles(cleanedArticles);
}
```

### Result
**All article entry points now clean HTML:**
- âœ… Supabase Import (line 538)
- âœ… Sanitize Content button (lines 266-270)
- âœ… Restore from Backup (lines 282-290) â† **NEW FIX**

**User will never see dirty HTML return again**, regardless of which backup file they restore.

---

## ðŸ“‹ Admin Dashboard Improvements

### 1. Collapsible Sidebar Menu
**File**: `pages/AdminDashboard.tsx`

Transformed flat menu into organized hierarchical sections:

#### Section Order:
1. **Content** (expanded by default)
   - Articles, Categories, Comments, Users

2. **AI Workforce** (collapsed by default)
   - All TENANT agents: Master, Journalist, Editor, SEO, Social, Automation, Subscriber, Business, Reader

3. **Integrations** (collapsed by default)
   - API Keys page

4. **Configuration** (collapsed by default)
   - Site Settings, Infrastructure

#### Implementation:
- State: `menuSections` object tracks open/close state (lines 141-146)
- Toggle: `toggleMenuSection()` function (lines 571-576)
- UI: Chevron icons rotate on expand/collapse

---

### 2. Integrations Page
**File**: `pages/AdminDashboard.tsx:998-1112`

New admin page for API key management with three main sections:

#### OpenWeatherMap Section
- API key input (password field)
- Default location input
- **"Test Key" button** - Validates API key with live request
- Visual save confirmation: "âœ“ Saved to browser storage"
- Blue tip box: Hard refresh instructions

#### Google Gemini AI Section
- API key input (password field)
- Shows .env configuration status
- Override capability for runtime testing
- Blue info box explaining .env priority

#### Payment Processors (Placeholder)
- Coming soon section for Stripe/PayPal
- Indicates subscription management requirement

#### Integration Guide
- Purple help box with:
  - OpenWeatherMap free tier info (1,000 calls/day)
  - Gemini free tier info (15 requests/min)
  - Security note about localStorage storage

---

### 3. Articles Page Filtering & Sorting
**File**: `pages/AdminDashboard.tsx:611-764`

Complete overhaul with advanced filtering and sorting capabilities.

#### State Variables (Lines 97-100):
```typescript
const [articleSortField, setArticleSortField] = useState<'title' | 'category' | 'status' | 'date'>('date');
const [articleSortDirection, setArticleSortDirection] = useState<'asc' | 'desc'>('desc');
const [articleFilterCategory, setArticleFilterCategory] = useState<string>('All');
const [articleFilterStatus, setArticleFilterStatus] = useState<string>('All');
```

#### Features:
1. **Filter Bar** (lines 663-702)
   - Category dropdown (All Categories + dynamic list)
   - Status dropdown (All, Published, Draft, Archived)
   - Items per page selector (10, 15, 25, 50)

2. **Sortable Columns** (lines 708-720)
   - Click column headers to sort
   - Visual indicators (chevron rotates on direction change)
   - Fields: Title, Category, Status, Date

3. **Date Column** (line 742)
   - Displays createdAt timestamp
   - Formatted as locale date string
   - Sortable field

4. **Color-Coded Status Badges** (lines 733-740)
   - Published: Green
   - Draft: Yellow
   - Archived: Gray

5. **Empty State** (lines 751-756)
   - Shows when no articles match filters
   - File icon with friendly message

6. **Pagination** (line 761)
   - Works with filtered results
   - Shows "X to Y of Z" count

---

## ðŸŽ¨ Frontend Improvements

### Breaking News Ticker Alignment
**File**: `components/BreakingNews.tsx:56-77`

**Problem**: Ticker spanned full page width instead of aligning with logo.

**Solution**: Wrapped content in container classes matching logo layout:

```tsx
<div className="w-full bg-white border-b border-gray-200 h-[36px]">
  <div className="container mx-auto px-4 md:px-0 h-full flex items-center overflow-hidden">
    {/* Breaking Label + Headlines */}
  </div>
</div>
```

**Result**: Ticker now aligns perfectly with logo on all screen sizes.

---

## ðŸ“Š Technical Architecture

### Data Flow
```
User Action â†’ UI State â†’ Auto-save â†’ IndexedDB â†’ React State â†’ UI Update
                                   â†“
                              localStorage (settings)
                                   â†“
                         window.dispatchEvent('settings-updated')
                                   â†“
                         Other components reload settings
```

### Storage Strategy
- **IndexedDB**: Articles, Categories, Comments (via `dbService`)
- **localStorage**: Settings, import credentials, voice preferences
- **Firestore**: Configured but not actively used (future multi-tenant support)

### Data Sources
- **Primary**: IndexedDB (`wnc_platform_db` v5)
- **Import**: Supabase REST API
- **Backup/Restore**: JSON files (user-managed)

### HTML Sanitization Points
1. **Supabase Import** - `handleSupabaseImport()` line 538
2. **Sanitize Button** - `handleSanitizeDatabase()` lines 266-270
3. **Restore Function** - `handleExecuteRestore()` lines 282-290 â† NEW

---

## ðŸ”§ Configuration Files

### Git Repository
- **Remote**: `https://github.com/carlucci001/gwnct-core.git`
- **Main Branch**: `main` (stable baseline)
- **Dev Branch**: `dev` (active development)
- **Current**: 18 commits ahead of origin/dev

### Environment Variables
Required in `.env` file:
```env
VITE_GEMINI_API_KEY=your_gemini_api_key_here
```

Access in code via: `process.env.API_KEY`

### Firebase Configuration
- **Project ID**: `gen-lang-client-0242565142`
- **Database**: `gwnct` (Firestore named database)
- **Deployed URL**: `https://gen-lang-client-0242565142.web.app`

---

## ðŸ“¦ Git Tags & Restore Points

### v1.0-stable
Initial clean baseline with core features working.

### v1.1-weather-stable
Weather widget + header layout updates complete.

### v1.2-sanitize-persist
Article sanitization persistence bug fixed.

### v1.3-session-complete â† **CURRENT**
All session objectives completed:
- Admin UX improvements
- Integrations page
- Articles filtering/sorting
- Critical bug fixes

---

## ðŸš€ How to Continue Development

### Local Development
```bash
cd c:\dev\wnc-times-clone
npm run dev
# Access at http://localhost:3000
```

### View Admin Dashboard
1. Navigate to `http://localhost:3000/#/admin`
2. Login with admin credentials
3. All new features visible immediately

### Deploy to Firebase
```bash
npm run build
firebase deploy
```

### Restore to This Point
```bash
git checkout v1.3-session-complete
npm install
npm run dev
```

---

## ðŸ”— AI Studio Integration Setup

### Repository Information
- **GitHub URL**: `https://github.com/carlucci001/gwnct-core.git`
- **Clone Command**: `git clone https://github.com/carlucci001/gwnct-core.git`
- **Branch to Use**: `dev`
- **Latest Commit**: `1cc955f` (Update Firebase build cache)

### Required API Keys
1. **Google Gemini API** (Already configured in `.env`)
   - Used for: Chat assistant, AI agents, article generation
   - Get key: https://aistudio.google.com/apikey

2. **OpenWeatherMap API** (Configured in admin)
   - Used for: Weather widget in header
   - Get key: https://openweathermap.org/api

### Project Structure
```
wnc-times-clone/
â”œâ”€â”€ components/          # React components
â”‚   â”œâ”€â”€ BreakingNews.tsx
â”‚   â”œâ”€â”€ ChatAssistant.tsx
â”‚   â”œâ”€â”€ Header.tsx
â”‚   â””â”€â”€ WeatherWidget.tsx
â”œâ”€â”€ pages/              # Route pages
â”‚   â””â”€â”€ AdminDashboard.tsx
â”œâ”€â”€ services/           # Business logic
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ db.ts
â”‚   â””â”€â”€ storage.ts
â”œâ”€â”€ data/               # Configuration
â”‚   â””â”€â”€ prompts.ts      # AI agent definitions
â”œâ”€â”€ .env               # Environment variables
â”œâ”€â”€ firebase.ts        # Firebase config
â””â”€â”€ vite.config.ts     # Build config
```

---

## âœ… Verification Checklist

Before opening in AI Studio, verify:

- [x] All commits are pushed to `dev` branch
- [x] Latest tag is `v1.3-session-complete`
- [x] localhost:3000 is working
- [x] Admin dashboard loads without errors
- [x] Articles page shows filtering/sorting UI
- [x] Integrations page is visible in sidebar
- [x] Breaking news ticker aligns with logo
- [x] Weather widget displays (if API key configured)
- [x] `.env` file contains `VITE_GEMINI_API_KEY`

---

## ðŸ“ Known Issues & Future Work

### Working Perfectly âœ…
- Article sanitization persistence
- Admin sidebar organization
- Integrations page functionality
- Articles filtering and sorting
- Breaking news alignment
- Weather widget integration
- Chat assistant with voice

### Future Enhancements (Not Blocking)
- Payment processor integration (Stripe/PayPal)
- Multi-tenant Firestore synchronization
- Real-time collaborative editing
- Advanced analytics dashboard
- Email notification system

---

## ðŸŽ“ Key Learnings from This Session

### React Best Practices
- **Hooks must be at top level** - Never inside render functions
- **State management** - Use descriptive variable names for complex state
- **Conditional rendering** - Clean patterns with ternary operators

### Data Persistence
- **Always sanitize on entry** - All data sources must clean HTML
- **Backup/restore cycle** - Consider user workflows, not just current state
- **IndexedDB reliability** - Browser storage is persistent across refreshes

### UX Principles
- **Visual feedback** - Always show save/loading states
- **Test buttons** - Let users verify integrations immediately
- **Progressive disclosure** - Collapsible sections reduce cognitive load

---

## ðŸ“ž Support & Resources

### Documentation
- React 19: https://react.dev
- Vite: https://vitejs.dev
- IndexedDB: https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API
- Gemini API: https://ai.google.dev/docs

### Repository
- GitHub: https://github.com/carlucci001/gwnct-core
- Issues: Create issues for bugs or feature requests
- Pull Requests: Welcome from collaborators

---

**Session completed successfully. All objectives met. Ready for AI Studio integration.**


--- FILE: C:\dev\wnct-next\old_react_mds\SESSION_ANALYSIS.md ---
# Session Analysis - Current State

**Date**: 2025-12-05
**Session**: Continuation from previous authentication recovery

---

## âœ… COMPLETED & WORKING

### 1. **Authentication System** (Previous Session - Commits c537d07 & c3d7ada)
- âœ… Complete password authentication (SHA-256 hashing with salt)
- âœ… Google OAuth integration via Firebase
- âœ… Login page with username/email + password
- âœ… Registration form with password strength indicator
- âœ… Password reset flow (request, verify token, reset)
- âœ… Remember Me functionality (30-day persistence)
- âœ… Session management (30-minute timeout with activity tracking)
- âœ… Protected routes based on roles and permissions
- âœ… 7 user roles with 17 granular permissions
- âœ… Admin credentials: `admin` / `admin123`

**Files**: services/auth.ts, services/passwordUtils.ts, services/googleAuth.ts, pages/Login.tsx, components/ProtectedRoute.tsx, components/SessionManager.tsx

### 2. **Users Section - Complete Menu** (This Session - Commit 9dec0a8)
- âœ… All Users - List view with search, filters, block/unblock
- âœ… Roles & Permissions - Complete permission matrix for all 7 roles
- âœ… Add New User - Full creation form with password validation
- âœ… User Activity Log - Login history and activity tracking

**Files**: pages/AdminDashboard.tsx (lines 4105-4108, 2378-2558), data/rolePermissions.ts

### 3. **AI Article Generator - Publishing Workflow** (This Session - Commit 9dec0a8)
- âœ… Manual/AI Mode Toggle - Switch between AI generation and manual entry
- âœ… Auto-Publish checkbox - Automatically publish generated articles
- âœ… Send to Editor checkbox - Set status to "Review" for editor approval
- âœ… Article Status dropdown - Choose Draft/Review/Published
- âœ… Workflow integration - handleAiDraft respects all publishing options
- âœ… Conditional save - Auto-publish triggers automatic save

**Files**: pages/AdminDashboard.tsx (lines 165-169, 705-740, 4384-4518)

### 4. **Type System & Routing** (This Session - Commit 9dec0a8)
- âœ… User type extended with authentication fields (username, passwordHash, passwordSalt, session tokens)
- âœ… App.tsx updated with ProtectedRoute wrapping for Community, User Dashboard, Admin routes
- âœ… SessionManager integrated into app root
- âœ… Auth routes added (ForgotPassword, ResetPassword, AccessDenied)

**Files**: types.ts (lines 134-155), App.tsx (lines 17-23, 35-82)

---

## âœ… FIXED IN THIS SESSION

### 1. **News Flow Status Bar** (COMPLETED - Commit e61bf37)
**User Description**: "I don't see the status bar up top where it shows being drafted from the journalists all the way through. You had a nice status bar up there. Look in the status bar editor status bar so we can follow the workflow. The news flow, we called it news flow."

**Implementation**: Visual progress indicator in article editor modal showing:
```
ðŸ“ Draft (blue) â†’ ðŸ‘ï¸ Review (amber) â†’ âœ… Published (green)
```

**Features**:
- Active stage highlighted with shadow and scale-110 animation
- Completed stages show checkmark icon with green background
- Smooth transitions with duration-300
- Connector lines between stages turn green when completed
- Located in article editor modal header (lines 4411-4488)

**Status**: âœ… COMPLETE

---

### 2. **Admin Dashboard Layout** (COMPLETED - Commit e61bf37)
**User's Original Request**: "I uploaded an image in the root folder to JPEG image. But it's still all squished. It doesn't look right the rest of the pages, the other menus look right, but the admin dashboard. Page looks horrible. It goes super wide and squishes out the main menu."

**Implementation**:
- Added max-w-[1800px] to prevent content from stretching too wide
- Added mx-auto for horizontal centering
- Added responsive padding (px-4 md:px-6 py-6)
- Changed overflow from overflow-hidden to overflow-y-auto

**Verification**: âœ… `npm run verify:layout` - All checks pass

**Status**: âœ… COMPLETE

---

## ðŸ“‹ FILES MODIFIED IN THIS SESSION

### Commit 9dec0a8 (Latest)
- **App.tsx** (+45 lines) - Added ProtectedRoute, SessionManager, auth routes
- **types.ts** (+9 lines) - Extended User interface with auth fields
- **pages/AdminDashboard.tsx** (+380 lines, -44 lines) - Users menu, AI Generator workflow, render functions
- **package.json** (+3 lines, -1 line) - No significant changes (formatting)
- **pages/AdminDashboard.backup.tsx** (+2 lines, -1 line) - Backup file, minor changes
- **services/auth.ts.backup-1764965210** (+218 lines) - New backup file created

### Previous Commits (Referenced)
- **c3d7ada**: Fix Login page with complete authentication UI
- **c537d07**: Add complete authentication system with password & OAuth support

---

## ðŸ” COMPREHENSIVE STATUS CHECK

### What Works Now:
1. âœ… Full authentication system (password + OAuth)
2. âœ… Login/Register/Password Reset flows
3. âœ… Session management with timeout warnings
4. âœ… Protected routes with role-based access control
5. âœ… Complete Users management section (4 menu items)
6. âœ… AI Article Generator with publishing workflow options
7. âœ… Roles & Permissions matrix display
8. âœ… User Activity tracking

### All Issues Resolved:
1. âœ… **News Flow Status Bar** - Complete with animations and visual feedback
2. âœ… **Admin Dashboard Layout** - Width constrained and centered

### No Known Breakages or Issues:
- All previously working features remain functional
- No regressions detected in authentication, user management, or article editing
- Type system properly extended without breaking existing code
- Routing properly protected without affecting public pages

---

## ðŸ“Š COMMIT SUMMARY

| Commit | Description | Files Changed | Lines Added | Lines Removed |
|--------|-------------|---------------|-------------|---------------|
| 9dec0a8 | Users menu + AI Generator workflow | 6 files | 613 | 44 |
| c3d7ada | Fix Login page with auth UI | - | - | - |
| c537d07 | Add complete auth system | - | - | - |

---

## âœ… CRITICAL FIX - Firebase Firestore Integration (Commit f7245fa)

### Problem:
**User Report**: "All the articles are gone. We have these articles stored in Firebase somewhere."

**Root Cause**:
- Articles were stored in Firebase Firestore database 'gwnct', collection 'articles'
- Application was only querying IndexedDB which was empty after version upgrade
- IndexedDB version bump from 7â†’8 created new empty database

### Solution:
1. Added Firebase Firestore imports to AdminDashboard.tsx
2. Modified loadData() to query Firebase Firestore collection 'articles'
3. Cache articles to IndexedDB for offline access
4. Keep users loading from authService (localStorage) with admin/admin123

### Implementation:
```typescript
// Load articles from Firebase Firestore
const articlesSnapshot = await getDocs(collection(firestore, 'articles'));
let arts = articlesSnapshot.docs.map(doc => ({
  id: doc.id,
  ...doc.data()
})) as Article[];
console.log(`[Firebase] Loaded ${arts.length} articles from Firestore`);

// Cache to IndexedDB for offline access
if (arts.length > 0) {
  await dbService.saveArticles(arts);
}
```

### Status: âœ… COMPLETE

**Files Changed**: [pages/AdminDashboard.tsx](pages/AdminDashboard.tsx#L22-L23) (Firebase imports), [pages/AdminDashboard.tsx](pages/AdminDashboard.tsx#L337-L359) (loadData function)

---

## ðŸŽ¯ NEXT STEPS (ALL COMPLETE)

1. âœ… **Add News Flow Status Bar** to article editor modal - DONE (Commit e61bf37)
2. âœ… **Fix Admin Dashboard Layout** width constraint - DONE (Commit e61bf37)
3. âœ… **Verify layout with script** - PASSED (npm run verify:layout)
4. âœ… **Fix Firebase Firestore Integration** - DONE (Commit f7245fa)

---

## ðŸ’¾ READY TO USE!

### Current State: **âœ… COMPLETE & PRODUCTION READY**

**All Features Working**:
- âœ… Complete authentication system (password + OAuth)
- âœ… Session management with 30-minute timeout
- âœ… Protected routes with role-based access control
- âœ… Users section with 4 complete menu items
- âœ… AI Article Generator with full publishing workflow
- âœ… News Flow Status Bar in article editor
- âœ… Admin Dashboard layout properly constrained
- âœ… Roles & Permissions matrix display
- âœ… User Activity tracking
- âœ… **Firebase Firestore integration** - Articles loaded from database 'gwnct'
- âœ… **Admin user initialized** - Credentials: admin / admin123

**No Issues**:
- âœ… No broken functionality detected
- âœ… All verification scripts pass
- âœ… No TypeScript errors (only hints for unused variables)
- âœ… All original requests fulfilled

**Recommendation**: This session is COMPLETE. All requested features have been restored and both identified issues have been fixed. Safe to proceed with development or testing.

---

*Generated: 2025-12-05*
*Session: Authentication Recovery & Feature Restoration*


